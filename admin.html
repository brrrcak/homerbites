<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Homer Bites Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Inter', 'system-ui', 'sans-serif'],
                    },
                    colors: {
                        'brand': {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            400: '#38bdf8',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            900: '#1e3a8a',
                        },
                        'accent': {
                            400: '#fb7185',
                            500: '#f43f5e',
                            600: '#e11d48',
                        }
                    },
                    animation: {
                        'slide-up': 'slideUp 0.5s ease-out',
                        'fade-in': 'fadeIn 0.3s ease-out',
                        'scale-in': 'scaleIn 0.2s ease-out',
                    },
                    keyframes: {
                        slideUp: {
                            '0%': { transform: 'translateY(100px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        scaleIn: {
                            '0%': { transform: 'scale(0.9)', opacity: '0' },
                            '100%': { transform: 'scale(1)', opacity: '1' },
                        }
                    }
                }
            }
        }
        
        // Initialize Supabase with your actual credentials
window.supabase = window.supabase.createClient(
    'https://qtjwacufuwkehfkkijsl.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF0andhY3VmdXdrZWhma2tpanNsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYwOTY5NTksImV4cCI6MjA3MTY3Mjk1OX0.bh33UFK75tnb13Cr0FhI-MByl0OTEtPj5lJdoJoLuQc'
);
        
        const supabase = window.supabase;
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 min-h-screen font-sans antialiased">

    <!-- Navigation -->
    <nav class="relative z-50 backdrop-blur-xl bg-white/10 border-b border-white/10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center space-x-4">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-gradient-to-r from-brand-500 to-accent-500 rounded-xl flex items-center justify-center text-white font-bold text-xl shadow-lg shadow-brand-500/25">
                            HB
                        </div>
                        <div class="ml-3">
                            <h1 class="text-xl font-bold text-white">Homer Bites Admin</h1>
                            <p class="text-xs text-gray-300">Restaurant management panel</p>
                        </div>
                    </div>
                </div>

                <div id="adminAuth" class="flex items-center space-x-3">
                    <button id="loginBtn" class="px-4 py-2 bg-gradient-to-r from-brand-500 to-brand-600 text-white rounded-xl font-medium text-sm hover:from-brand-600 hover:to-brand-700 transition-all duration-200 shadow-lg shadow-brand-500/25 hover:scale-105 active:scale-95">
                        Admin Login
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div id="adminContent" class="hidden relative z-10 py-8">
        
        <!-- Dashboard Stats -->
        <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mb-8">
            <div class="backdrop-blur-xl bg-white/10 rounded-3xl p-8 border border-white/20 shadow-2xl">
                <h2 class="text-3xl font-bold text-white mb-6 text-center">Dashboard Overview</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="backdrop-blur-xl bg-white/10 p-6 rounded-2xl border border-white/20">
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl flex items-center justify-center text-white font-bold text-xl shadow-lg">
                                üçΩÔ∏è
                            </div>
                            <div class="ml-4">
                                <h3 class="font-semibold text-white">Total Restaurants</h3>
                                <p id="totalRestaurants" class="text-3xl font-bold text-blue-400">0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="backdrop-blur-xl bg-white/10 p-6 rounded-2xl border border-white/20">
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-gradient-to-r from-yellow-500 to-orange-500 rounded-xl flex items-center justify-center text-white font-bold text-xl shadow-lg">
                                ‚è≥
                            </div>
                            <div class="ml-4">
                                <h3 class="font-semibold text-white">Pending Submissions</h3>
                                <p id="pendingSubmissions" class="text-3xl font-bold text-yellow-400">0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="backdrop-blur-xl bg-white/10 p-6 rounded-2xl border border-white/20">
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-gradient-to-r from-green-500 to-emerald-500 rounded-xl flex items-center justify-center text-white font-bold text-xl shadow-lg">
                                üìà
                            </div>
                            <div class="ml-4">
                                <h3 class="font-semibold text-white">This Month</h3>
                                <p id="monthlySubmissions" class="text-3xl font-bold text-green-400">0</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Main Content Grid -->
        <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                
                <!-- Pending Submissions -->
                <div class="backdrop-blur-xl bg-white/10 rounded-3xl border border-white/20 shadow-2xl">
                    <div class="p-6 border-b border-white/20">
                        <div class="flex items-center justify-between">
                            <h2 class="text-2xl font-bold text-white">Pending Submissions</h2>
                            <div class="w-8 h-8 bg-gradient-to-r from-yellow-500 to-orange-500 rounded-lg flex items-center justify-center">
                                <span class="text-white text-sm font-bold">üìã</span>
                            </div>
                        </div>
                        <p class="text-gray-300 text-sm mt-2">Review and approve new restaurant submissions</p>
                    </div>
                    <div id="pendingSubmissionsList" class="p-6 max-h-96 overflow-y-auto">
                        <div class="text-center py-8">
                            <div class="w-16 h-16 bg-white/10 rounded-full flex items-center justify-center mx-auto mb-4">
                                <span class="text-2xl">üìù</span>
                            </div>
                            <p class="text-gray-400">Loading submissions...</p>
                        </div>
                    </div>
                </div>

                <!-- Restaurant Management -->
                <div class="backdrop-blur-xl bg-white/10 rounded-3xl border border-white/20 shadow-2xl">
                    <div class="p-6 border-b border-white/20">
                        <div class="flex items-center justify-between">
                            <div>
                                <h2 class="text-2xl font-bold text-white">Restaurant Management</h2>
                                <p class="text-gray-300 text-sm mt-1">Manage approved restaurants</p>
                            </div>
                            <button id="addRestaurantBtn" class="px-4 py-2 bg-gradient-to-r from-brand-500 to-brand-600 text-white rounded-xl font-medium text-sm hover:from-brand-600 hover:to-brand-700 transition-all duration-200 shadow-lg shadow-brand-500/25 hover:scale-105 active:scale-95">
                                Add Restaurant
                            </button>
                        </div>
                    </div>
                    <div id="restaurantsList" class="p-6 max-h-96 overflow-y-auto">
                        <div class="text-center py-8">
                            <div class="w-16 h-16 bg-white/10 rounded-full flex items-center justify-center mx-auto mb-4">
                                <span class="text-2xl">üè™</span>
                            </div>
                            <p class="text-gray-400">Loading restaurants...</p>
                        </div>
                    </div>
                </div>
                
            </div>
        </section>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 z-50 hidden">
        <div class="fixed inset-0 bg-black/50 backdrop-blur-sm" onclick="closeLoginModal()"></div>
        <div class="fixed inset-0 flex items-center justify-center p-4">
            <div class="backdrop-blur-2xl bg-slate-800/90 rounded-3xl max-w-md w-full shadow-2xl animate-scale-in border border-white/20">
                <div class="relative p-8">
                    <button onclick="closeLoginModal()" class="absolute top-4 right-4 w-10 h-10 bg-white/10 backdrop-blur-sm rounded-full flex items-center justify-center text-white hover:bg-white/20 transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                    
                    <div class="text-center mb-8">
                        <div class="w-16 h-16 bg-gradient-to-r from-brand-500 to-accent-500 rounded-2xl flex items-center justify-center mx-auto mb-4">
                            <span class="text-white font-bold text-2xl">üîê</span>
                        </div>
                        <h2 class="text-2xl font-bold text-white mb-2">Admin Login</h2>
                        <p class="text-gray-300">Enter your credentials to access the admin panel</p>
                    </div>
                    
                    <form id="loginForm">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Email Address</label>
                                <input type="email" name="email" required 
                                       class="w-full px-4 py-3 bg-white/5 border border-white/20 rounded-xl shadow-sm placeholder-gray-400 text-white focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-transparent transition-all duration-200">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Password</label>
                                <input type="password" name="password" required 
                                       class="w-full px-4 py-3 bg-white/5 border border-white/20 rounded-xl shadow-sm placeholder-gray-400 text-white focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-transparent transition-all duration-200">
                            </div>
                        </div>
                        <button type="submit" class="w-full mt-8 px-6 py-3 bg-gradient-to-r from-brand-500 to-accent-500 text-white font-semibold rounded-xl hover:from-brand-600 hover:to-accent-600 transition-all duration-200 shadow-lg shadow-brand-500/25 hover:scale-105 active:scale-95">
                            Login to Admin Panel
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Review Submission Modal -->
    <div id="reviewModal" class="fixed inset-0 z-50 hidden">
        <div class="fixed inset-0 bg-black/50 backdrop-blur-sm" onclick="closeReviewModal()"></div>
        <div class="fixed inset-0 flex items-center justify-center p-4">
            <div class="backdrop-blur-2xl bg-slate-800/90 rounded-3xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl animate-scale-in border border-white/20">
                <div class="relative p-8">
                    <button onclick="closeReviewModal()" class="absolute top-4 right-4 w-10 h-10 bg-white/10 backdrop-blur-sm rounded-full flex items-center justify-center text-white hover:bg-white/20 transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                    
                    <h2 class="text-2xl font-bold text-white mb-6">Review Restaurant Submission</h2>
                    <div id="reviewContent" class="text-gray-300"></div>
                    
                    <div class="flex gap-4 mt-8">
                        <button id="approveBtn" class="flex-1 px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white font-semibold rounded-xl hover:from-green-600 hover:to-emerald-600 transition-all duration-200 shadow-lg hover:scale-105 active:scale-95">
                            ‚úÖ Approve
                        </button>
                        <button id="rejectBtn" class="flex-1 px-6 py-3 bg-gradient-to-r from-red-500 to-pink-500 text-white font-semibold rounded-xl hover:from-red-600 hover:to-pink-600 transition-all duration-200 shadow-lg hover:scale-105 active:scale-95">
                            ‚ùå Reject
                        </button>
                        <button id="cancelReviewBtn" class="flex-1 px-6 py-3 bg-white/10 text-white font-semibold rounded-xl hover:bg-white/20 transition-all duration-200">
                            Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="relative z-10 py-12 mt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="backdrop-blur-xl bg-white/5 rounded-3xl p-8 border border-white/10 text-center">
                <div class="flex items-center justify-center mb-4">
                    <div class="w-8 h-8 bg-gradient-to-r from-brand-500 to-accent-500 rounded-lg flex items-center justify-center text-white font-bold text-sm">
                        HB
                    </div>
                    <span class="ml-3 text-lg font-semibold text-white">Homer Bites Admin</span>
                </div>
                <p class="text-gray-400 mb-2">&copy; 2025 Homer Bites. Restaurant management made easy.</p>
                <p class="text-sm text-gray-500">Secure admin panel for managing Homer, Alaska's restaurant directory</p>
            </div>
        </div>
    </footer>

    <script>
        let currentUser = null;
        let currentSubmission = null;

        document.addEventListener('DOMContentLoaded', function() {
            checkAuthState();
            setupEventListeners();
        });

        async function checkAuthState() {
            try {
                const { data: { user } } = await supabase.auth.getUser();
                
                if (user) {
                    // Check if user is admin
                    const { data: profile } = await supabase
                        .from('user_profiles')
                        .select('is_admin')
                        .eq('id', user.id)
                        .single();
                    
                    if (profile && profile.is_admin) {
                        currentUser = user;
                        showAdminPanel();
                        loadDashboardData();
                    } else {
                        alert('Access denied. Admin privileges required.');
                        // Auto-show login for non-admin users
                        showLogin();
                    }
                } else {
                    // Auto-show login for unauthenticated users
                    showLogin();
                }
            } catch (error) {
                console.error('Auth check failed:', error);
                // Auto-show login if there's an error
                showLogin();
            }
        }

        function setupEventListeners() {
            document.getElementById('loginBtn').addEventListener('click', showLogin);
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('addRestaurantBtn').addEventListener('click', () => {
                alert('Add restaurant feature coming soon!');
            });
        }

        function showLogin() {
            document.getElementById('loginModal').classList.remove('hidden');
        }

        function closeLoginModal() {
            document.getElementById('loginModal').classList.add('hidden');
        }

        function showAdminPanel() {
            document.getElementById('adminAuth').innerHTML = `
                <span class="text-white text-sm mr-4">Welcome, Admin</span>
                <button onclick="handleLogout()" class="px-4 py-2 bg-gradient-to-r from-red-500 to-pink-500 text-white rounded-xl font-medium text-sm hover:from-red-600 hover:to-pink-600 transition-all duration-200 shadow-lg hover:scale-105 active:scale-95">
                    Logout
                </button>
            `;
            document.getElementById('adminContent').classList.remove('hidden');
            closeLoginModal();
        }

        async function handleLogin(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const submitButton = e.target.querySelector('button[type="submit"]');
            const originalButtonText = submitButton.innerHTML;
            
            // Show loading state
            submitButton.disabled = true;
            submitButton.innerHTML = 'Signing In...';
            
            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: formData.get('email'),
                    password: formData.get('password')
                });

                if (error) throw error;

                // Login successful, check auth state again
                await checkAuthState();
                
            } catch (error) {
                console.error('Login error:', error);
                alert('Login failed: ' + error.message);
                
                // Reset button
                submitButton.disabled = false;
                submitButton.innerHTML = originalButtonText;
            }
        }

        async function handleLogout() {
            await supabase.auth.signOut();
            currentUser = null;
            document.getElementById('adminContent').classList.add('hidden');
            document.getElementById('adminAuth').innerHTML = `
                <button id="loginBtn" class="px-4 py-2 bg-gradient-to-r from-brand-500 to-brand-600 text-white rounded-xl font-medium text-sm hover:from-brand-600 hover:to-brand-700 transition-all duration-200 shadow-lg shadow-brand-500/25 hover:scale-105 active:scale-95">
                    Admin Login
                </button>
            `;
            document.getElementById('loginBtn').addEventListener('click', showLogin);
        }

        async function loadDashboardData() {
            // Load total restaurants
            const { count: restaurantCount } = await supabase
                .from('restaurants')
                .select('*', { count: 'exact', head: true })
                .eq('status', 'approved');
            
            document.getElementById('totalRestaurants').textContent = restaurantCount || 0;

            // Load pending submissions
            const { data: pendingSubmissions, count: pendingCount } = await supabase
                .from('restaurant_submissions')
                .select('*', { count: 'exact' })
                .eq('status', 'pending');
            
            document.getElementById('pendingSubmissions').textContent = pendingCount || 0;

            // Load monthly submissions
            const startOfMonth = new Date();
            startOfMonth.setDate(1);
            startOfMonth.setHours(0, 0, 0, 0);
            
            const { count: monthlyCount } = await supabase
                .from('restaurant_submissions')
                .select('*', { count: 'exact', head: true })
                .gte('created_at', startOfMonth.toISOString());
            
            document.getElementById('monthlySubmissions').textContent = monthlyCount || 0;

            // Load lists
            loadPendingSubmissions(pendingSubmissions);
            loadRestaurants();
        }

        function loadPendingSubmissions(submissions) {
            const container = document.getElementById('pendingSubmissionsList');
            
            if (!submissions || submissions.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8">
                        <div class="w-16 h-16 bg-white/10 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-2xl">‚úÖ</span>
                        </div>
                        <p class="text-gray-400">No pending submissions</p>
                        <p class="text-gray-500 text-sm mt-2">All caught up!</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = submissions.map(submission => `
                <div class="backdrop-blur-xl bg-white/5 border border-white/20 rounded-2xl p-4 mb-4 hover:bg-white/10 transition-all duration-200">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <h3 class="font-bold text-white text-lg">${submission.name}</h3>
                            <p class="text-gray-300 text-sm mb-3">${submission.description || 'No description provided'}</p>
                            <div class="flex items-center text-xs text-gray-400 space-x-4">
                                <span>üìÖ ${new Date(submission.created_at).toLocaleDateString()}</span>
                                ${submission.address ? `<span>üìç ${submission.address}</span>` : ''}
                            </div>
                        </div>
                        <button onclick="reviewSubmission(${submission.id})" 
                                class="ml-4 px-4 py-2 bg-gradient-to-r from-brand-500 to-accent-500 text-white rounded-xl text-sm font-medium hover:from-brand-600 hover:to-accent-600 transition-all duration-200 shadow-lg hover:scale-105 active:scale-95">
                            Review
                        </button>
                    </div>
                </div>
            `).join('');
        }

        async function loadRestaurants() {
            const { data: restaurants } = await supabase
                .from('restaurants')
                .select('*')
                .eq('status', 'approved')
                .order('name');

            const container = document.getElementById('restaurantsList');
            
            if (!restaurants || restaurants.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8">
                        <div class="w-16 h-16 bg-white/10 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-2xl">üè™</span>
                        </div>
                        <p class="text-gray-400">No restaurants found</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = restaurants.map(restaurant => `
                <div class="backdrop-blur-xl bg-white/5 border border-white/20 rounded-2xl p-4 mb-3 hover:bg-white/10 transition-all duration-200">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <h3 class="font-bold text-white">${restaurant.name}</h3>
                            <p class="text-gray-300 text-sm">${restaurant.address || 'No address provided'}</p>
                            ${restaurant.tags ? `<div class="flex flex-wrap gap-1 mt-2">${restaurant.tags.map(tag => `<span class="px-2 py-1 bg-brand-500/20 text-brand-300 text-xs rounded-lg">${tag}</span>`).join('')}</div>` : ''}
                        </div>
                        <div class="ml-4 flex space-x-2">
                            <button onclick="editRestaurant(${restaurant.id})" 
                                    class="px-3 py-1 bg-gradient-to-r from-yellow-500 to-orange-500 text-white rounded-lg text-xs font-medium hover:from-yellow-600 hover:to-orange-600 transition-all duration-200 hover:scale-105 active:scale-95">
                                Edit
                            </button>
                            <button onclick="deleteRestaurant(${restaurant.id})" 
                                    class="px-3 py-1 bg-gradient-to-r from-red-500 to-pink-500 text-white rounded-lg text-xs font-medium hover:from-red-600 hover:to-pink-600 transition-all duration-200 hover:scale-105 active:scale-95">
                                Delete
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        async function reviewSubmission(submissionId) {
            const { data: submission } = await supabase
                .from('restaurant_submissions')
                .select('*')
                .eq('id', submissionId)
                .single();

            currentSubmission = submission;
            
            const reviewContent = document.getElementById('reviewContent');
            reviewContent.innerHTML = `
                <div class="space-y-6">
                    <div class="backdrop-blur-xl bg-white/5 rounded-2xl p-4 border border-white/20">
                        <label class="block font-semibold text-white mb-2">Restaurant Name:</label>
                        <p class="text-gray-300">${submission.name}</p>
                    </div>
                    
                    <div class="backdrop-blur-xl bg-white/5 rounded-2xl p-4 border border-white/20">
                        <label class="block font-semibold text-white mb-2">Description:</label>
                        <p class="text-gray-300">${submission.description || 'No description provided'}</p>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-4">
                        <div class="backdrop-blur-xl bg-white/5 rounded-2xl p-4 border border-white/20">
                            <label class="block font-semibold text-white mb-2">Address:</label>
                            <p class="text-gray-300">${submission.address || 'Not provided'}</p>
                        </div>
                        
                        <div class="backdrop-blur-xl bg-white/5 rounded-2xl p-4 border border-white/20">
                            <label class="block font-semibold text-white mb-2">Website:</label>
                            <p class="text-gray-300">${submission.website || 'Not provided'}</p>
                        </div>
                    </div>
                    
                    <div class="backdrop-blur-xl bg-white/5 rounded-2xl p-4 border border-white/20">
                        <label class="block font-semibold text-white mb-2">Submitted:</label>
                        <p class="text-gray-300">${new Date(submission.created_at).toLocaleString()}</p>
                    </div>
                    
                    ${submission.image_file_name ? `
                        <div class="backdrop-blur-xl bg-white/5 rounded-2xl p-4 border border-white/20">
                            <label class="block font-semibold text-white mb-2">Submitted Image:</label>
                            <img src="${submission.image_file_name}" alt="Restaurant" class="w-full h-48 object-cover rounded-xl">
                        </div>
                    ` : ''}
                </div>
            `;

            document.getElementById('reviewModal').classList.remove('hidden');
            
            document.getElementById('approveBtn').onclick = () => approveSubmission(submission);
            document.getElementById('rejectBtn').onclick = () => rejectSubmission(submission);
            document.getElementById('cancelReviewBtn').onclick = closeReviewModal;
        }

        function closeReviewModal() {
            document.getElementById('reviewModal').classList.add('hidden');
        }

        async function approveSubmission(submission) {
            try {
                // Create restaurant from submission
                const { data: newRestaurant, error: insertError } = await supabase
                    .from('restaurants')
                    .insert([
                        {
                            name: submission.name,
                            description: submission.description,
                            address: submission.address,
                            website: submission.website,
                            image_url: submission.image_file_name,
                            tags: ['restaurant'], // Default tags, can be edited later
                            status: 'approved',
                            submitted_by: submission.submitted_by
                        }
                    ]);

                if (insertError) throw insertError;

                // Update submission status
                const { error: updateError } = await supabase
                    .from('restaurant_submissions')
                    .update({ 
                        status: 'approved',
                        reviewed_at: new Date().toISOString(),
                        reviewed_by: currentUser.id
                    })
                    .eq('id', submission.id);

                if (updateError) throw updateError;

                alert('‚úÖ Submission approved successfully!');
                closeReviewModal();
                loadDashboardData();

            } catch (error) {
                console.error('Error approving submission:', error);
                alert('‚ùå Error approving submission: ' + error.message);
            }
        }

        async function rejectSubmission(submission) {
            const reason = prompt('üí≠ Reason for rejection (optional):');
            
            try {
                const { error } = await supabase
                    .from('restaurant_submissions')
                    .update({ 
                        status: 'rejected',
                        reviewed_at: new Date().toISOString(),
                        reviewed_by: currentUser.id,
                        notes: reason
                    })
                    .eq('id', submission.id);

                if (error) throw error;

                alert('‚ùå Submission rejected successfully!');
                closeReviewModal();
                loadDashboardData();

            } catch (error) {
                console.error('Error rejecting submission:', error);
                alert('Error rejecting submission: ' + error.message);
            }
        }

        async function editRestaurant(restaurantId) {
            // Simple edit functionality - you can expand this
            const newName = prompt('‚úèÔ∏è Enter new restaurant name:');
            if (!newName) return;

            try {
                const { error } = await supabase
                    .from('restaurants')
                    .update({ name: newName })
                    .eq('id', restaurantId);

                if (error) throw error;

                alert('‚úÖ Restaurant updated successfully!');
                loadRestaurants();

            } catch (error) {
                console.error('Error updating restaurant:', error);
                alert('‚ùå Error updating restaurant: ' + error.message);
            }
        }

        async function deleteRestaurant(restaurantId) {
            if (!confirm('‚ö†Ô∏è Are you sure you want to delete this restaurant?\n\nThis action cannot be undone.')) return;

            try {
                const { error } = await supabase
                    .from('restaurants')
                    .delete()
                    .eq('id', restaurantId);

                if (error) throw error;

                alert('‚úÖ Restaurant deleted successfully!');
                loadDashboardData();

            } catch (error) {
                console.error('Error deleting restaurant:', error);
                alert('‚ùå Error deleting restaurant: ' + error.message);
            }
        }
    </script>

    <style>
        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #581c87 50%, #0f172a 100%);
            background-attachment: fixed;
            min-height: 100vh;
            color: white;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.6);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(59, 130, 246, 0.8);
        }

        /* Glassmorphism effects */
        .backdrop-blur-xl {
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
        }

        .backdrop-blur-2xl {
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
        }
    </style>

</body>
</html>
