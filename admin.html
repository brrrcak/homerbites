<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Homer Bites Admin Panel</title>
    <meta name="description" content="Administrative panel for managing Homer Bites restaurant submissions and content.">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Montserrat:wght@400;500;600;700&display=swap');

        :root {
            --color-primary: #FF7043; /* Warm Orange */
            --color-secondary: #4CAF50; /* Fresh Green */
            --color-accent: #2196F3; /* Sky Blue */
            --color-text-dark: #333333;
            --color-text-light: #555555;
            --color-bg-light: #F9FAFB; /* Off-white */
            --color-bg-paper: #FFFFFF; /* Pure White */
            --shadow-subtle: 0 4px 12px rgba(0, 0, 0, 0.05);
            --shadow-medium: 0 8px 24px rgba(0, 0, 0, 0.08);
            --shadow-strong: 0 12px 36px rgba(0, 0, 0, 0.12);
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--color-bg-light);
            color: var(--color-text-light);
            line-height: 1.6;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Playfair Display', serif;
            color: var(--color-text-dark);
        }

        /* Custom Scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: var(--color-bg-light);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #d1d5db; /* Light gray */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #9ca3af; /* Darker gray */
        }

        /* Button Hover Effect */
        .btn-hover-scale {
            transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
        }
        .btn-hover-scale:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        /* Card Hover Effect */
        .card-hover-lift {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card-hover-lift:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-medium);
        }

        /* Input Focus Styling */
        input:focus, textarea:focus, select:focus {
            border-color: var(--color-accent) !important;
            box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.2) !important;
        }

        .modal-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }
        .modal-slide-up {
            animation: slideUp 0.3s ease-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .stat-card.green {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
        }
        .stat-card.orange {
            background: linear-gradient(135deg, #FF7043 0%, #f4511e 100%);
        }
        .stat-card.blue {
            background: linear-gradient(135deg, #2196F3 0%, #1976d2 100%);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-rose-50 min-h-screen font-sans antialiased">

    <!-- Navigation Bar -->
    <header class="sticky top-0 z-50 bg-white/80 backdrop-blur-md shadow-sm border-b border-gray-100 py-3">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between">
            <a href="index.html" class="flex items-center space-x-3 group">
                <div class="w-10 h-10 bg-gradient-to-br from-rose-500 to-orange-500 rounded-lg flex items-center justify-center text-white font-extrabold text-xl shadow-md group-hover:shadow-lg transition-all duration-300">
                    HB
                </div>
                <div>
                    <h1 class="text-xl font-bold text-gray-800 tracking-tight">Homer Bites Admin</h1>
                    <p class="text-xs text-gray-500">Restaurant management panel</p>
                </div>
            </a>

            <div id="adminAuth" class="flex items-center space-x-3">
                <button id="loginBtn" class="flex items-center px-6 py-2 bg-blue-500 text-white rounded-full shadow-md hover:bg-blue-600 transition-all duration-300 btn-hover-scale">
                    <i data-lucide="log-in" class="w-4 h-4 mr-2"></i>
                    Admin Login
                </button>
            </div>
        </div>
    </header>

    <!-- Admin Content -->
    <main id="adminContent" class="hidden py-12">
        <!-- Dashboard Overview -->
        <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mb-12">
            <div class="bg-white rounded-3xl shadow-lg border border-gray-100 p-8">
                <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">Dashboard Overview</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="stat-card blue p-6 rounded-2xl text-white text-center">
                        <div class="flex items-center justify-center mb-4">
                            <i data-lucide="restaurant" class="w-8 h-8"></i>
                        </div>
                        <h3 class="text-lg font-semibold mb-2">Total Restaurants</h3>
                        <p id="totalRestaurants" class="text-3xl font-bold">0</p>
                    </div>
                    <div class="stat-card orange p-6 rounded-2xl text-white text-center">
                        <div class="flex items-center justify-center mb-4">
                            <i data-lucide="clock" class="w-8 h-8"></i>
                        </div>
                        <h3 class="text-lg font-semibold mb-2">Pending Submissions</h3>
                        <p id="pendingSubmissions" class="text-3xl font-bold">0</p>
                    </div>
                    <div class="stat-card green p-6 rounded-2xl text-white text-center">
                        <div class="flex items-center justify-center mb-4">
                            <i data-lucide="trending-up" class="w-8 h-8"></i>
                        </div>
                        <h3 class="text-lg font-semibold mb-2">This Month</h3>
                        <p id="monthlySubmissions" class="text-3xl font-bold">0</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Management Sections -->
        <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                
                <!-- Pending Submissions -->
                <div class="bg-white rounded-3xl shadow-lg border border-gray-100">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-2xl font-bold text-gray-800">Pending Submissions</h3>
                                <p class="text-gray-600 text-sm mt-1">Review and approve new submissions</p>
                            </div>
                            <div class="p-3 bg-orange-100 rounded-full">
                                <i data-lucide="clock" class="w-6 h-6 text-orange-600"></i>
                            </div>
                        </div>
                    </div>
                    <div id="pendingSubmissionsList" class="p-6 max-h-96 overflow-y-auto">
                        <div class="text-center py-8">
                            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500 mx-auto mb-4"></div>
                            <p class="text-gray-500">Loading pending submissions...</p>
                        </div>
                    </div>
                </div>

                <!-- Restaurant Management -->
                <div class="bg-white rounded-3xl shadow-lg border border-gray-100">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-2xl font-bold text-gray-800">Restaurant Management</h3>
                                <p class="text-gray-600 text-sm mt-1">Manage approved restaurants</p>
                            </div>
                            <div class="p-3 bg-blue-100 rounded-full">
                                <i data-lucide="restaurant" class="w-6 h-6 text-blue-600"></i>
                            </div>
                        </div>
                    </div>
                    <div id="restaurantsList" class="p-6 max-h-96 overflow-y-auto">
                        <div class="text-center py-8">
                            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto mb-4"></div>
                            <p class="text-gray-500">Loading restaurants...</p>
                        </div>
                    </div>
                </div>

            </div>
        </section>
    </main>

    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 z-50 hidden modal-fade-in">
        <div class="fixed inset-0 bg-black/40 backdrop-blur-sm"></div>
        <div class="fixed inset-0 flex items-center justify-center p-4">
            <div class="bg-white rounded-3xl max-w-md w-full shadow-2xl modal-slide-up">
                <div class="p-8 relative">
                    <button type="button" onclick="closeLoginModal()" class="absolute top-4 right-4 w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center text-gray-600 hover:bg-gray-200 transition-colors">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Admin Login</h2>
                    <form id="loginForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                            <input type="email" name="email" required class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-200 focus:border-blue-500 outline-none transition-all">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                            <input type="password" name="password" required class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-200 focus:border-blue-500 outline-none transition-all">
                        </div>
                        <button type="submit" class="w-full flex items-center justify-center px-6 py-3 bg-blue-500 text-white rounded-full shadow-lg hover:bg-blue-600 transition-all duration-300 btn-hover-scale font-semibold">
                            <i data-lucide="log-in" class="w-5 h-5 mr-2"></i>
                            Login
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Review Modal -->
    <div id="reviewModal" class="fixed inset-0 z-50 hidden modal-fade-in">
        <div class="fixed inset-0 bg-black/40 backdrop-blur-sm"></div>
        <div class="fixed inset-0 flex items-center justify-center p-4">
            <div class="bg-white rounded-3xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl modal-slide-up">
                <div class="p-8 relative">
                    <button type="button" onclick="closeReviewModal()" class="absolute top-4 right-4 w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center text-gray-600 hover:bg-gray-200 transition-colors">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Review Submission</h2>
                    <div id="reviewContent" class="mb-8">
                        <!-- Content will be populated by JavaScript -->
                    </div>
                    <div class="flex gap-4">
                        <button id="approveBtn" class="flex-1 flex items-center justify-center px-6 py-3 bg-green-500 text-white rounded-full shadow-lg hover:bg-green-600 transition-all duration-300 btn-hover-scale font-semibold">
                            <i data-lucide="check" class="w-5 h-5 mr-2"></i>
                            Approve
                        </button>
                        <button id="rejectBtn" class="flex-1 flex items-center justify-center px-6 py-3 bg-red-500 text-white rounded-full shadow-lg hover:bg-red-600 transition-all duration-300 btn-hover-scale font-semibold">
                            <i data-lucide="x" class="w-5 h-5 mr-2"></i>
                            Reject
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Restaurant Modal -->
    <div id="editRestaurantModal" class="fixed inset-0 z-50 hidden modal-fade-in">
        <div class="fixed inset-0 bg-black/40 backdrop-blur-sm"></div>
        <div class="fixed inset-0 flex items-center justify-center p-4">
            <div class="bg-white rounded-3xl max-w-4xl w-full max-h-[90vh] overflow-y-auto shadow-2xl modal-slide-up">
                <form id="editRestaurantForm" class="p-8 relative">
                    <button type="button" onclick="closeEditModal()" class="absolute top-4 right-4 w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center text-gray-600 hover:bg-gray-200 transition-colors">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Edit Restaurant</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                        <div class="md:col-span-2">
                            <label for="edit-name" class="block text-sm font-medium text-gray-700 mb-2">Name</label>
                            <input type="text" id="edit-name" class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-200 focus:border-blue-500 outline-none transition-all">
                        </div>
                        <div class="md:col-span-2">
                            <label for="edit-description" class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                            <textarea id="edit-description" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-200 focus:border-blue-500 outline-none transition-all"></textarea>
                        </div>
                        <div>
                            <label for="edit-address" class="block text-sm font-medium text-gray-700 mb-2">Address</label>
                            <input type="text" id="edit-address" class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-200 focus:border-blue-500 outline-none transition-all">
                        </div>
                        <div>
                            <label for="edit-phone" class="block text-sm font-medium text-gray-700 mb-2">Phone</label>
                            <input type="tel" id="edit-phone" class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-200 focus:border-blue-500 outline-none transition-all">
                        </div>
                        <div>
                            <label for="edit-website" class="block text-sm font-medium text-gray-700 mb-2">Website URL</label>
                            <input type="url" id="edit-website" class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-200 focus:border-blue-500 outline-none transition-all">
                        </div>
                        <div>
                            <label for="edit-hours" class="block text-sm font-medium text-gray-700 mb-2">Hours</label>
                            <input type="text" id="edit-hours" class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-200 focus:border-blue-500 outline-none transition-all">
                        </div>
                        <div class="md:col-span-2">
                            <label for="edit-image_url" class="block text-sm font-medium text-gray-700 mb-2">Image URL</label>
                            <input type="url" id="edit-image_url" class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-200 focus:border-blue-500 outline-none transition-all">
                        </div>
                        <div>
                            <label for="edit-menu_url" class="block text-sm font-medium text-gray-700 mb-2">Menu URL</label>
                            <input type="url" id="edit-menu_url" class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-200 focus:border-blue-500 outline-none transition-all">
                        </div>
                        <div>
                            <label for="edit-price_range" class="block text-sm font-medium text-gray-700 mb-2">Price Range</label>
                            <input type="text" id="edit-price_range" class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-200 focus:border-blue-500 outline-none transition-all">
                        </div>
                        <div>
                            <label for="edit-lat" class="block text-sm font-medium text-gray-700 mb-2">Latitude</label>
                            <input type="number" step="any" id="edit-lat" class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-200 focus:border-blue-500 outline-none transition-all">
                        </div>
                        <div>
                            <label for="edit-lng" class="block text-sm font-medium text-gray-700 mb-2">Longitude</label>
                            <input type="number" step="any" id="edit-lng" class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-200 focus:border-blue-500 outline-none transition-all">
                        </div>
                        <div>
                            <label for="edit-rating" class="block text-sm font-medium text-gray-700 mb-2">Rating</label>
                            <input type="number" step="0.1" id="edit-rating" class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-200 focus:border-blue-500 outline-none transition-all">
                        </div>
                        <div class="md:col-span-2">
                            <label for="edit-tags" class="block text-sm font-medium text-gray-700 mb-2">Tags (comma-separated)</label>
                            <input type="text" id="edit-tags" class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-200 focus:border-blue-500 outline-none transition-all">
                        </div>
                    </div>
                    <div class="flex gap-4">
                        <button type="submit" class="flex-1 flex items-center justify-center px-6 py-3 bg-blue-500 text-white rounded-full shadow-lg hover:bg-blue-600 transition-all duration-300 btn-hover-scale font-semibold">
                            <i data-lucide="save" class="w-5 h-5 mr-2"></i>
                            Save Changes
                        </button>
                        <button type="button" onclick="closeEditModal()" class="flex-1 flex items-center justify-center px-6 py-3 bg-gray-500 text-white rounded-full shadow-lg hover:bg-gray-600 transition-all duration-300 btn-hover-scale font-semibold">
                            <i data-lucide="x" class="w-5 h-5 mr-2"></i>
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Footer Section -->
    <footer class="bg-gray-800 text-white py-12 mt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <div class="flex flex-col md:flex-row items-center justify-between space-y-4 md:space-y-0 mb-8">
                <a href="index.html" class="flex items-center space-x-3 group">
                    <div class="w-10 h-10 bg-gradient-to-br from-rose-500 to-orange-500 rounded-lg flex items-center justify-center text-white font-extrabold text-xl">
                        HB
                    </div>
                    <span class="text-2xl font-bold text-white tracking-tight">Homer Bites</span>
                </a>
                <nav class="flex space-x-6 text-sm font-medium">
                    <a href="index.html" class="text-gray-300 hover:text-white transition-colors">Back to Site</a>
                </nav>
            </div>
            <p class="text-gray-400 text-sm">Â© 2025 Homer Bites. Administrative Panel.</p>
        </div>
    </footer>

    <script src="modals.js?v=1.2"></script>
    <script>
        // Initialize Lucide Icons
        lucide.createIcons();
        
        // Initialize Supabase
        const SUPABASE_URL = 'https://qtjwacufuwkehfkkijsl.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF0andhY3VmdXdrZWhma2tpanNsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYwOTY5NTksImV4cCI6MjA3MTY3Mjk1OX0.bh33UFK75tnb13Cr0FhI-MByl0OTEtPj5lJdoJoLuQc';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        let currentUser = null, currentUserProfile = null;

        document.addEventListener('DOMContentLoaded', initializeApp);

        async function initializeApp() {
            setupEventListeners();
            await checkAuthState();
        }

        function setupEventListeners() {
            const loginBtn = document.getElementById('loginBtn');
            if (loginBtn) loginBtn.addEventListener('click', showLogin);
            
            const loginForm = document.getElementById('loginForm');
            if (loginForm) loginForm.addEventListener('submit', handleLogin);

            const editRestaurantForm = document.getElementById('editRestaurantForm');
            if (editRestaurantForm) editRestaurantForm.addEventListener('submit', handleUpdateRestaurant);
        }
        
        async function checkAuthState() {
            try {
                const { data: { user } } = await supabase.auth.getUser();
                if (!user) return showLogin();
                const { data: profile } = await supabase.from('user_profiles').select('*').eq('id', user.id).single();
                if (!profile || !profile.is_admin) {
                    await showCustomAlert('Access denied. Admin privileges required.');
                    return showLogin();
                }
                currentUser = user;
                currentUserProfile = profile;
                showAdminPanel();
                loadDashboardData();
            } catch (error) {
                console.error('Auth check failed:', error);
                showLogin();
            }
        }

        const showLogin = () => document.getElementById('loginModal').classList.remove('hidden');
        const closeLoginModal = () => document.getElementById('loginModal').classList.add('hidden');
        const closeReviewModal = () => document.getElementById('reviewModal').classList.add('hidden');
        const closeEditModal = () => document.getElementById('editRestaurantModal').classList.add('hidden');

        function showAdminPanel() {
            const displayName = currentUserProfile?.full_name || currentUser?.email || 'Admin';
            document.getElementById('adminAuth').innerHTML = `
                <span class="text-gray-700 text-sm mr-4">Welcome, ${displayName.split(' ')[0]}!</span>
                <button onclick="handleLogout()" class="flex items-center px-4 py-2 bg-red-500 text-white rounded-full shadow-md hover:bg-red-600 transition-all duration-300 btn-hover-scale text-sm">
                    <i data-lucide="log-out" class="w-4 h-4 mr-2"></i>
                    Logout
                </button>
            `;
            document.getElementById('adminContent').classList.remove('hidden');
            closeLoginModal();
            lucide.createIcons();
        }

        async function handleLogin(e) { 
            e.preventDefault(); 
            const formData = new FormData(e.target);
            const email = formData.get('email');
            const password = formData.get('password');
            const { error } = await supabase.auth.signInWithPassword({ email, password }); 
            if (error) return showCustomAlert('Login failed: ' + error.message); 
            initializeApp(); 
        }

        async function handleLogout() { 
            await supabase.auth.signOut(); 
            currentUser = null; 
            currentUserProfile = null; 
            document.getElementById('adminContent').classList.add('hidden'); 
            document.getElementById('adminAuth').innerHTML = `
                <button id="loginBtn" class="flex items-center px-6 py-2 bg-blue-500 text-white rounded-full shadow-md hover:bg-blue-600 transition-all duration-300 btn-hover-scale">
                    <i data-lucide="log-in" class="w-4 h-4 mr-2"></i>
                    Admin Login
                </button>
            `; 
            setupEventListeners(); 
            showLogin();
            lucide.createIcons();
        }
        
        async function loadDashboardData() { 
            const { count: restaurantCount } = await supabase.from('restaurants').select('*', { count: 'exact', head: true }).eq('status', 'approved'); 
            document.getElementById('totalRestaurants').textContent = restaurantCount || 0; 
            const { data: pendingSubmissions, count: pendingCount } = await supabase.from('restaurant_submissions').select('*', { count: 'exact' }).eq('status', 'pending'); 
            document.getElementById('pendingSubmissions').textContent = pendingCount || 0; 
            loadPendingSubmissions(pendingSubmissions); 
            loadRestaurants(); 
        }

        function loadPendingSubmissions(submissions) { 
            const container = document.getElementById('pendingSubmissionsList'); 
            if (!submissions || submissions.length === 0) { 
                container.innerHTML = `
                    <div class="text-center py-8">
                        <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i data-lucide="inbox" class="w-8 h-8 text-gray-400"></i>
                        </div>
                        <p class="text-gray-500">No pending submissions</p>
                    </div>
                `; 
                lucide.createIcons();
                return; 
            } 
            container.innerHTML = submissions.map(sub => `
                <div class="bg-gray-50 border border-gray-200 rounded-2xl p-4 mb-3 flex justify-between items-center hover:shadow-md transition-all">
                    <div>
                        <h4 class="font-bold text-gray-800">${sub.name}</h4>
                        <p class="text-gray-500 text-sm">${new Date(sub.created_at).toLocaleDateString()}</p>
                    </div>
                    <button onclick="reviewSubmission(${sub.id})" class="flex items-center px-4 py-2 bg-orange-500 text-white rounded-full shadow-md hover:bg-orange-600 transition-all btn-hover-scale text-sm">
                        <i data-lucide="eye" class="w-4 h-4 mr-2"></i>
                        Review
                    </button>
                </div>
            `).join(''); 
            lucide.createIcons();
        }

        async function loadRestaurants() { 
            const { data: restaurants } = await supabase.from('restaurants').select('*').eq('status', 'approved').order('name'); 
            const container = document.getElementById('restaurantsList'); 
            if (!restaurants || restaurants.length === 0) { 
                container.innerHTML = `
                    <div class="text-center py-8">
                        <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i data-lucide="restaurant" class="w-8 h-8 text-gray-400"></i>
                        </div>
                        <p class="text-gray-500">No approved restaurants found</p>
                    </div>
                `; 
                lucide.createIcons();
                return; 
            } 
            container.innerHTML = restaurants.map(r => `
                <div class="bg-gray-50 border border-gray-200 rounded-2xl p-4 mb-3 flex justify-between items-center hover:shadow-md transition-all">
                    <div>
                        <h4 class="font-bold text-gray-800">${r.name}</h4>
                        <p class="text-gray-500 text-sm">${r.address || 'No address'}</p>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="editRestaurant(${r.id})" class="flex items-center px-3 py-2 bg-blue-500 text-white rounded-full shadow-md hover:bg-blue-600 transition-all btn-hover-scale text-sm">
                            <i data-lucide="edit" class="w-4 h-4 mr-1"></i>
                            Edit
                        </button>
                        <button onclick="deleteRestaurant(${r.id})" class="flex items-center px-3 py-2 bg-red-500 text-white rounded-full shadow-md hover:bg-red-600 transition-all btn-hover-scale text-sm">
                            <i data-lucide="trash-2" class="w-4 h-4 mr-1"></i>
                            Delete
                        </button>
                    </div>
                </div>
            `).join(''); 
            lucide.createIcons();
        }

        async function reviewSubmission(id) { 
            const { data: sub } = await supabase.from('restaurant_submissions').select('*').eq('id', id).single(); 
            document.getElementById('reviewContent').innerHTML = `
                <div class="space-y-4">
                    <div class="bg-gray-50 p-4 rounded-xl">
                        <h4 class="font-semibold text-gray-800 mb-2">Restaurant Details</h4>
                        <div class="space-y-2 text-sm">
                            <p><strong>Name:</strong> ${sub.name}</p>
                            <p><strong>Description:</strong> ${sub.description || 'N/A'}</p>
                            <p><strong>Address:</strong> ${sub.address || 'N/A'}</p>
                            <p><strong>Website:</strong> ${sub.website || 'N/A'}</p>
                        </div>
                    </div>
                    ${sub.image_file_name ? `<div class="bg-gray-50 p-4 rounded-xl"><h4 class="font-semibold text-gray-800 mb-2">Submitted Image</h4><img src="${sub.image_file_name}" class="rounded-lg w-full h-48 object-cover"></div>` : ''}
                </div>
            `; 
            document.getElementById('reviewModal').classList.remove('hidden'); 
            document.getElementById('approveBtn').onclick = () => approveSubmission(sub); 
            document.getElementById('rejectBtn').onclick = () => rejectSubmission(sub); 
        }

        async function approveSubmission(submission) { 
            await supabase.from('restaurants').insert([{ 
                name: submission.name, 
                description: submission.description, 
                address: submission.address, 
                website: submission.website, 
                image_url: submission.image_file_name, 
                status: 'approved', 
                submitted_by: submission.submitted_by 
            }]); 
            await supabase.from('restaurant_submissions').update({ status: 'approved', reviewed_by: currentUser.id }).eq('id', submission.id); 
            await showCustomAlert('Submission approved!', 'success'); 
            closeReviewModal(); 
            loadDashboardData(); 
        }

        async function rejectSubmission(submission) { 
            await supabase.from('restaurant_submissions').update({ status: 'rejected', reviewed_by: currentUser.id }).eq('id', submission.id); 
            await showCustomAlert('Submission rejected.'); 
            closeReviewModal(); 
            loadDashboardData(); 
        }
        
        async function editRestaurant(id) {
            const { data: r } = await supabase.from('restaurants').select('*').eq('id', id).single();
            if (!r) return showCustomAlert('Error: Restaurant not found.', 'error');
            const form = document.getElementById('editRestaurantForm');
            form.querySelector('#edit-name').value = r.name || '';
            form.querySelector('#edit-description').value = r.description || '';
            form.querySelector('#edit-address').value = r.address || '';
            form.querySelector('#edit-phone').value = r.phone || '';
            form.querySelector('#edit-website').value = r.website || '';
            form.querySelector('#edit-hours').value = r.hours || '';
            form.querySelector('#edit-image_url').value = r.image_url || '';
            form.querySelector('#edit-menu_url').value = r.menu_url || '';
            form.querySelector('#edit-lat').value = r.lat ?? '';
            form.querySelector('#edit-lng').value = r.lng ?? '';
            form.querySelector('#edit-rating').value = r.rating ?? '';
            form.querySelector('#edit-price_range').value = r.price_range || '';
            form.querySelector('#edit-tags').value = (r.tags || []).join(', ');
            form.dataset.editingId = r.id;
            document.getElementById('editRestaurantModal').classList.remove('hidden');
        }

        async function handleUpdateRestaurant(e) {
            e.preventDefault();
            const form = e.target;
            const id = form.dataset.editingId;
            const updateData = { 
                name: form.querySelector('#edit-name').value, 
                description: form.querySelector('#edit-description').value, 
                address: form.querySelector('#edit-address').value, 
                phone: form.querySelector('#edit-phone').value, 
                website: form.querySelector('#edit-website').value, 
                hours: form.querySelector('#edit-hours').value, 
                image_url: form.querySelector('#edit-image_url').value, 
                menu_url: form.querySelector('#edit-menu_url').value, 
                price_range: form.querySelector('#edit-price_range').value, 
                lat: form.querySelector('#edit-lat').value ? parseFloat(form.querySelector('#edit-lat').value) : null, 
                lng: form.querySelector('#edit-lng').value ? parseFloat(form.querySelector('#edit-lng').value) : null, 
                rating: form.querySelector('#edit-rating').value ? parseFloat(form.querySelector('#edit-rating').value) : null, 
                tags: form.querySelector('#edit-tags').value.split(',').map(t => t.trim()).filter(Boolean) 
            };
            const { error } = await supabase.from('restaurants').update(updateData).eq('id', id);
            if (error) return showCustomAlert('Error updating restaurant: ' + error.message, 'error');
            await showCustomAlert('Restaurant updated successfully!', 'success');
            closeEditModal();
            loadRestaurants();
        }
        
        async function deleteRestaurant(id) {
            const confirmed = await showCustomConfirm('Are you sure you want to delete this restaurant? This action cannot be undone.');
            if (!confirmed) return;
            
            const { error } = await supabase.from('restaurants').delete().eq('id', id);
            if (error) return showCustomAlert('Error deleting restaurant: ' + error.message, 'error');
            await showCustomAlert('Restaurant deleted.');
            loadDashboardData();
        }

        // Custom Alert Function (matches the new styling)
        function showCustomAlert(message, type = 'info') {
            const existingAlert = document.getElementById('custom-alert-overlay');
            if (existingAlert) {
                existingAlert.remove();
            }
            
            const overlay = document.createElement('div');
            overlay.id = 'custom-alert-overlay';
            overlay.className = 'fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center p-4 z-50';
            
            const iconColor = type === 'success' ? 'text-green-500' : type === 'error' ? 'text-red-500' : 'text-blue-500';
            const iconName = type === 'success' ? 'check-circle' : type === 'error' ? 'x-circle' : 'info';
            
            overlay.innerHTML = `
                <div class="bg-white rounded-3xl shadow-2xl max-w-sm w-full p-8 text-center modal-slide-up">
                    <div class="mb-4">
                        <i data-lucide="${iconName}" class="w-12 h-12 ${iconColor} mx-auto"></i>
                    </div>
                    <p class="text-gray-800 mb-6">${message}</p>
                    <button id="custom-alert-ok" class="px-6 py-3 bg-blue-500 text-white rounded-full shadow-lg hover:bg-blue-600 transition-all btn-hover-scale font-semibold">
                        OK
                    </button>
                </div>
            `;
            
            document.body.appendChild(overlay);
            lucide.createIcons();
            
            document.getElementById('custom-alert-ok').addEventListener('click', () => {
                overlay.remove();
            });
        }

        function showCustomConfirm(message) {
            return new Promise(resolve => {
                const existingConfirm = document.getElementById('custom-confirm-overlay');
                if (existingConfirm) {
                    existingConfirm.remove();
                }
                const overlay = document.createElement('div');
                overlay.id = 'custom-confirm-overlay';
                overlay.className = 'fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center p-4 z-50';
                
                const modalHTML = `
                    <div class="bg-white rounded-3xl shadow-2xl max-w-sm w-full p-8 text-center modal-slide-up">
                        <div class="mb-4">
                            <i data-lucide="alert-triangle" class="w-12 h-12 text-orange-500 mx-auto"></i>
                        </div>
                        <p class="text-gray-800 mb-6">${message}</p>
                        <div class="flex gap-4">
                            <button id="custom-confirm-cancel" class="flex-1 px-6 py-3 bg-gray-500 text-white rounded-full shadow-lg hover:bg-gray-600 transition-all btn-hover-scale font-semibold">Cancel</button>
                            <button id="custom-confirm-ok" class="flex-1 px-6 py-3 bg-red-500 text-white rounded-full shadow-lg hover:bg-red-600 transition-all btn-hover-scale font-semibold">Confirm</button>
                        </div>
                    </div>
                `;
                
                overlay.innerHTML = modalHTML;
                document.body.appendChild(overlay);
                lucide.createIcons();
                
                const okButton = document.getElementById('custom-confirm-ok');
                const cancelButton = document.getElementById('custom-confirm-cancel');
                okButton.addEventListener('click', () => {
                    overlay.remove();
                    resolve(true);
                });
                cancelButton.addEventListener('click', () => {
                    overlay.remove();
                    resolve(false);
                });
            });
        }
    </script>
</body>
</html>
