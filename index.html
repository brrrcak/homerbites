<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Homer Bites - A Culinary Journey in Homer, Alaska</title>
    <meta name="description" content="Discover the best local eateries, hidden gems, and delightful dining experiences in Homer, Alaska with Homer Bites.">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Montserrat:wght@400;500;600;700&display=swap');

        :root {
            --color-primary: #FF7043; /* Warm Orange */
            --color-secondary: #4CAF50; /* Fresh Green */
            --color-accent: #2196F3; /* Sky Blue */
            --color-text-dark: #333333;
            --color-text-light: #555555;
            --color-bg-light: #F9FAFB; /* Off-white */
            --color-bg-paper: #FFFFFF; /* Pure White */
            --shadow-subtle: 0 4px 12px rgba(0, 0, 0, 0.05);
            --shadow-medium: 0 8px 24px rgba(0, 0, 0, 0.08);
            --shadow-strong: 0 12px 36px rgba(0, 0, 0, 0.12);
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--color-bg-light);
            color: var(--color-text-light);
            line-height: 1.6;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Playfair Display', serif;
            color: var(--color-text-dark);
        }

        /* Custom Scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: var(--color-bg-light);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #d1d5db; /* Light gray */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #9ca3af; /* Darker gray */
        }

        /* Hero Wave Effect */
        .hero-wave {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            overflow: hidden;
            line-height: 0;
            transform: rotate(180deg);
        }

        .hero-wave svg {
            position: relative;
            display: block;
            width: calc(100% + 1.3px);
            height: 150px; /* Adjust height as needed */
        }

        .hero-wave .shape-fill {
            fill: var(--color-bg-light);
        }

        /* Subtle Button Hover Effect */
        .btn-hover-scale {
            transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
        }
        .btn-hover-scale:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        /* Card Hover Effect - Enhanced for restaurant cards */
        .card-hover-lift {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card-hover-lift:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        /* Enhanced Restaurant Card Styling */
        .restaurant-card {
            position: relative;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .restaurant-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
        }

        .restaurant-card .favorite-btn {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 44px;
            height: 44px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            z-index: 10;
        }

        .restaurant-card .favorite-btn:hover {
            background: rgba(255, 255, 255, 1);
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .restaurant-card .favorite-btn.favorited {
            background: rgba(239, 68, 68, 0.9);
            color: white;
        }

        .restaurant-card .favorite-btn.favorited:hover {
            background: rgba(239, 68, 68, 1);
        }

        /* Input Focus Styling */
        input:focus, textarea:focus {
            border-color: var(--color-accent) !important;
            box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.2) !important;
        }

        /* Cuisine Option Styling - Updated to be just text */
        .cuisine-option {
            display: inline-block;
            padding: 8px 12px;
            margin: 0 16px 8px 0;
            color: var(--color-text-light);
            font-weight: 500;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            user-select: none;
            text-decoration: none;
            border: none;
            background: none;
        }

        .cuisine-option:hover {
            color: var(--color-primary);
            transform: scale(1.05);
            text-decoration: underline;
            text-underline-offset: 4px;
        }

        .cuisine-option.selected {
            color: var(--color-primary);
            transform: scale(1.05);
            text-decoration: underline;
            text-underline-offset: 4px;
            font-weight: 600;
        }

        /* Tag Button Styling */
        .tag-button {
            background-color: #f0f4f8; /* Light blue-gray */
            color: var(--color-text-light);
            border: 1px solid #e2e8f0; /* Lighter border */
            transition: all 0.2s ease-out;
        }
        .tag-button:hover {
            background-color: #e2e8f0;
            border-color: var(--color-accent);
            color: var(--color-accent);
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.1);
        }
        .tag-button.active {
            background-color: var(--color-accent);
            color: white;
            border-color: var(--color-accent);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
            transform: translateY(-2px);
        }

        .modal-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }
        .modal-slide-up {
            animation: slideUp 0.3s ease-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Smooth scroll behavior */
        html {
            scroll-behavior: smooth;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-rose-50 min-h-screen font-sans antialiased">

    <!-- Navigation Bar -->
    <header class="sticky top-0 z-50 bg-white/80 backdrop-blur-md shadow-sm border-b border-gray-100 py-3">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between">
            <a href="#" class="flex items-center space-x-3 group animate-fade-in">
                <div class="w-10 h-10 bg-gradient-to-br from-rose-500 to-orange-500 rounded-lg flex items-center justify-center text-white font-extrabold text-xl shadow-md group-hover:shadow-lg transition-all duration-300">
                    HB
                </div>
                <div>
                    <h1 class="text-xl font-bold text-gray-800 tracking-tight">Homer Bites</h1>
                    <p class="text-xs text-gray-500">Discover local food</p>
                </div>
            </a>

            <nav class="hidden md:flex items-center space-x-6 text-sm font-medium">
                <a href="#hero" class="text-gray-600 hover:text-orange-500 transition-colors py-2">Discover</a>
                <a href="#about" class="text-gray-600 hover:text-orange-500 transition-colors py-2">About</a>
                <a href="#contact" class="text-gray-600 hover:text-orange-500 transition-colors py-2">Contact</a>
            </nav>

            <div id="authContainer" class="flex items-center space-x-3">
                <!-- Auth buttons will be populated by JavaScript -->
            </div>

            <button class="md:hidden p-2 rounded-md hover:bg-gray-100 text-gray-700 transition-colors">
                <i data-lucide="menu" class="w-6 h-6"></i>
            </button>
        </div>
    </header>

    <!-- Hero Section -->
    <section id="hero" class="relative bg-gradient-to-br from-blue-100 to-rose-100 py-24 sm:py-32 overflow-hidden text-center">
        <div class="relative z-10 max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-5xl md:text-6xl font-extrabold text-gray-800 leading-tight mb-6 animate-slide-up">
                Savor the Flavor of <span class="text-rose-600">Homer</span>.
            </h2>
            <p class="text-xl text-gray-600 mb-10 animate-fade-in">Your ultimate guide to Homer's vibrant culinary scene. Find local favorites, hidden gems, and unforgettable meals.</p>

            <div class="relative flex flex-col sm:flex-row items-center justify-center gap-4 mb-8 animate-fade-in">
                <input type="text" id="tagSearchInput" placeholder="Craving something specific? E.g., 'seafood', 'pizza'..." class="w-full sm:w-2/3 lg:w-1/2 px-6 py-4 rounded-full border border-gray-300 shadow-lg focus:ring-2 focus:ring-orange-200 focus:border-orange-500 transition-all outline-none text-gray-700 text-lg">
                <button id="findBtn" class="flex items-center justify-center w-full sm:w-auto px-8 py-4 bg-orange-500 text-white rounded-full shadow-lg hover:bg-orange-600 transition-all duration-300 btn-hover-scale text-lg font-semibold">
                    <i data-lucide="search" class="w-6 h-6 mr-3"></i>
                    Discover Eats
                </button>
            </div>

            <!-- Popular Cuisines to Explore - Moved under search box -->
            <div class="mb-8">
                <h3 class="text-lg font-semibold text-gray-700 mb-4">Popular Cuisines to Explore</h3>
                <div id="popularCuisines" class="flex flex-wrap justify-center">
                    <span class="cuisine-option" data-cuisine="seafood">Seafood</span>
                    <span class="cuisine-option" data-cuisine="american">American</span>
                    <span class="cuisine-option" data-cuisine="pizza">Pizza</span>
                    <span class="cuisine-option" data-cuisine="coffee">Coffee</span>
                    <span class="cuisine-option" data-cuisine="bakery">Bakery</span>
                    <span class="cuisine-option" data-cuisine="mexican">Mexican</span>
                    <span class="cuisine-option" data-cuisine="asian">Asian</span>
                    <span class="cuisine-option" data-cuisine="italian">Italian</span>
                    <span class="cuisine-option" data-cuisine="burgers">Burgers</span>
                    <span class="cuisine-option" data-cuisine="sandwiches">Sandwiches</span>
                    <span class="cuisine-option" data-cuisine="breakfast">Breakfast</span>
                    <span class="cuisine-option" data-cuisine="fine-dining">Fine Dining</span>
                </div>
            </div>
            
            <div class="flex justify-center gap-4 mb-6">
                <button id="viewAllBtn" class="px-6 py-3 text-gray-600 hover:text-orange-500 transition-colors text-lg font-medium">
                    Or simply <span class="underline underline-offset-4 decoration-dashed decoration-gray-400">browse all restaurants</span>
                </button>
                <!-- REMOVED: Surprise Me button as requested -->
            </div>
        </div>
        <!-- Hero Wave Background -->
        <div class="hero-wave">
            <svg data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120" preserveAspectRatio="none">
                <path d="M985.66,92.83C906.67,72,823.79,31,743.84,14.19c-82.26-17.34-168.35-16.64-250.46.15-82.7,17.7-172.14,87.31-257.83,11.3C155.18,74.58,66.44,53.13,0,34.52V0H1200V43.19C1128.15,68.8,1069.1,102.44,985.66,92.83Z" class="shape-fill"></path>
            </svg>
        </div>
    </section>

    <!-- REMOVED: Static Tags Section (Browse by Category) -->

    <!-- Restaurant Listings / Map Toggle -->
    <main id="restaurantsSection" class="relative z-10 py-16 bg-gray-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div id="viewToggleSection" class="hidden mb-10 flex justify-center gap-4 animate-fade-in">
                <button id="gridViewBtn" class="flex items-center space-x-2 px-6 py-3 bg-white text-gray-700 rounded-full shadow-md hover:bg-gray-100 transition-all btn-hover-scale active">
                    <i data-lucide="grid" class="w-5 h-5"></i>
                    <span class="font-medium">Grid View</span>
                </button>
                <button id="mapViewBtn" class="flex items-center space-x-2 px-6 py-3 bg-white text-gray-700 rounded-full shadow-md hover:bg-gray-100 transition-all btn-hover-scale">
                    <i data-lucide="map" class="w-5 h-5"></i>
                    <span class="font-medium">Map View</span>
                </button>
            </div>

            <div id="gridContent">
                <div id="categoryContainer" class="space-y-16">
                    <!-- Restaurant content will be populated by JavaScript -->
                </div>
            </div>

            <div id="mapContent" class="hidden">
                <div class="bg-white rounded-3xl shadow-lg border border-gray-100 overflow-hidden">
                    <div id="map" class="w-full h-[60vh]"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- About Section -->
    <section id="about" class="py-20 bg-gradient-to-br from-blue-50 to-rose-50">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h3 class="text-4xl font-extrabold text-gray-800 mb-6">Our Mission: Connecting You with Homer's Best</h3>
            <p class="text-lg text-gray-700 leading-relaxed mb-8">Homer Bites was built on two things: a deep love for our local food scene and a sheer frustration with trying to find it. We believe finding your next great meal shouldn't require hunting through social media or piecing together search results. Our mission is to showcase the town's incredible culinary talent, helping both lifelong residents and curious visitors easily discover everything from comforting classics to innovative new tastes.</p>
            <div class="flex flex-col sm:flex-row justify-center gap-6">
                <div class="bg-white p-6 rounded-2xl shadow-md flex-1 text-left card-hover-lift animate-slide-up">
                    <div class="text-orange-500 mb-3"><i data-lucide="heart" class="w-8 h-8"></i></div>
                    <h4 class="text-xl font-bold text-gray-800 mb-2">Love for Local</h4>
                    <p class="text-gray-600 text-sm">Our guide is dedicated to the independent restaurants, cafes, and food trucks owned and operated right here in our community.</p>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-md flex-1 text-left card-hover-lift animate-slide-up">
                    <div class="text-blue-500 mb-3"><i data-lucide="compass" class="w-8 h-8"></i></div>
                    <h4 class="text-xl font-bold text-gray-800 mb-2">Effortless Discovery</h4>
                    <p class="text-gray-600 text-sm">Our platform makes it easy to find exactly what you're craving, with intuitive search and curated categories.</p>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-md flex-1 text-left card-hover-lift animate-slide-up">
                    <div class="text-green-500 mb-3"><i data-lucide="users" class="w-8 h-8"></i></div>
                    <h4 class="text-xl font-bold text-gray-800 mb-2">Community Driven</h4>
                    <p class="text-gray-600 text-sm">Submit your favorite spots and help us grow our comprehensive guide. Together, we celebrate Homer's culinary spirit.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Call to Action Section -->
    <section class="py-16 bg-white text-center">
        <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
            <h3 class="text-3xl font-bold text-gray-800 mb-4">Don't See Your Favorite Spot?</h3>
            <p class="text-lg text-gray-600 mb-8">
                Help us make Homer Bites even better! If there's a restaurant you love that's not listed, please let us know.
            </p>
            <button id="submitRestaurantBtn_bottom" class="flex items-center justify-center mx-auto px-8 py-4 bg-rose-500 text-white rounded-full shadow-lg hover:bg-rose-600 transition-all duration-300 btn-hover-scale text-lg font-semibold">
                <i data-lucide="plus" class="w-6 h-6 mr-3"></i>
                Submit a Restaurant
            </button>
        </div>
    </section>

    <!-- Restaurant Detail Modal -->
    <div id="restaurantModal" class="fixed inset-0 z-50 hidden modal-fade-in">
        <div class="fixed inset-0 bg-black/40 backdrop-blur-sm" onclick="closeRestaurantModal()"></div>
        <div class="fixed inset-0 flex items-center justify-center p-4">
            <div class="bg-white rounded-3xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl modal-slide-up">
                <div class="relative">
                    <button onclick="closeRestaurantModal()" class="absolute top-4 right-4 z-10 w-10 h-10 bg-gray-100 text-gray-600 rounded-full flex items-center justify-center hover:bg-gray-200 transition-colors shadow-sm">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                    <div id="modalContent" class="p-8">
                        <!-- Dynamic content will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Submission Modal -->
    <div id="submissionModal" class="fixed inset-0 z-50 hidden modal-fade-in">
        <div class="fixed inset-0 bg-black/40 backdrop-blur-sm" onclick="closeSubmissionModal()"></div>
        <div class="fixed inset-0 flex items-center justify-center p-4">
            <div class="bg-white rounded-3xl max-w-lg w-full max-h-[90vh] overflow-y-auto shadow-2xl modal-slide-up">
                <div class="relative p-8">
                    <button onclick="closeSubmissionModal()" class="absolute top-4 right-4 z-10 w-10 h-10 bg-gray-100 text-gray-600 rounded-full flex items-center justify-center hover:bg-gray-200 transition-colors shadow-sm">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">Share a Culinary Gem</h2>
                    <p class="text-gray-600 mb-6">Help us grow our directory by suggesting a new restaurant.</p>
                    <form id="submissionForm" class="space-y-5">
                        <div>
                            <label for="restaurantName" class="block text-sm font-medium text-gray-700 mb-1">Restaurant Name</label>
                            <input type="text" id="restaurantName" name="restaurantName" required class="block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-200 focus:border-blue-500 outline-none transition-colors">
                        </div>
                        <div>
                            <label for="restaurantDescription" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                            <textarea id="restaurantDescription" name="restaurantDescription" rows="3" class="block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-200 focus:border-blue-500 outline-none transition-colors" placeholder="Briefly describe the restaurant..."></textarea>
                        </div>
                        <div>
                            <label for="restaurantWebsite" class="block text-sm font-medium text-gray-700 mb-1">Website (Optional)</label>
                            <input type="url" id="restaurantWebsite" name="restaurantWebsite" class="block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-200 focus:border-blue-500 outline-none transition-colors">
                        </div>
                        <div>
                            <label for="restaurantAddress" class="block text-sm font-medium text-gray-700 mb-1">Address</label>
                            <input type="text" id="restaurantAddress" name="restaurantAddress" class="block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-200 focus:border-blue-500 outline-none transition-colors">
                        </div>
                        <div>
                            <label for="restaurantImage" class="block text-sm font-medium text-gray-700 mb-1">Image (Optional)</label>
                            <input type="file" id="restaurantImage" name="restaurantImage" accept="image/*" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 transition-colors">
                        </div>
                        <div class="mt-6">
                            <button type="submit" class="w-full flex items-center justify-center px-6 py-3 bg-blue-500 text-white rounded-full shadow-lg hover:bg-blue-600 transition-all duration-300 btn-hover-scale text-base font-semibold">
                                <i data-lucide="send" class="w-5 h-5 mr-3"></i>
                                Submit Suggestion
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Auth Modal (will be dynamically created) -->
    
    <!-- Footer Section -->
    <footer id="contact" class="bg-gray-800 text-white py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <div class="flex flex-col md:flex-row items-center justify-between space-y-4 md:space-y-0 mb-8">
                <a href="#" class="flex items-center space-x-3 group">
                    <div class="w-10 h-10 bg-gradient-to-br from-rose-500 to-orange-500 rounded-lg flex items-center justify-center text-white font-extrabold text-xl">
                        HB
                    </div>
                    <span class="text-2xl font-bold text-white tracking-tight">Homer Bites</span>
                </a>
                <nav class="flex space-x-6 text-sm font-medium">
                    <a href="#hero" class="text-gray-300 hover:text-white transition-colors">Discover</a>
                    <a href="#about" class="text-gray-300 hover:text-white transition-colors">About Us</a>
                    <a href="#contact" class="text-gray-300 hover:text-white transition-colors">Support</a>
                    <a href="admin.html" class="text-gray-300 hover:text-white transition-colors">Admin</a>
                </nav>
            </div>
            <p class="text-gray-400 text-sm">Â© 2025 Homer Bites. Crafted with passion for the rich flavors of Homer, Alaska.</p>
        </div>
    </footer>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    
    <script>
        // Initialize Lucide Icons
        lucide.createIcons();
        
        // Initialize Supabase with error handling
        let supabase = null;
        try {
            const SUPABASE_URL = 'https://qtjwacufuwkehfkkijsl.supabase.co';
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF0andhY3VmdXdrZWhma2tpanNsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYwOTY5NTksImV4cCI6MjA3MTY3Mjk1OX0.bh33UFK75tnb13Cr0FhI-MByl0OTEtPj5lJdoJoLuQc';
            
            if (window.supabase && window.supabase.createClient) {
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                console.log('Supabase initialized successfully');
            } else {
                console.error('Supabase library not loaded');
            }
        } catch (error) {
            console.error('Failed to initialize Supabase:', error);
        }

        // Global variables for favorites and selections
        let selectedCuisine = null;
        let userFavorites = new Set();
        let restaurants = [];
        let currentUser = null;

        // Demo restaurant data (fallback when Supabase fails)
        const demoRestaurants = [
            {
                id: 1,
                name: "The Salty Dawg Saloon",
                description: "Historic saloon with live music and hearty Alaskan fare",
                cuisine: "American",
                address: "4380 Homer Spit Rd, Homer, AK",
                rating: 4.5,
                image: null,
                tags: ["bar", "live music", "historic"]
            },
            {
                id: 2,
                name: "Coal Point Seafood Company",
                description: "Fresh local seafood with stunning views of Kachemak Bay",
                cuisine: "Seafood",
                address: "4306 Homer Spit Rd, Homer, AK", 
                rating: 4.8,
                image: null,
                tags: ["seafood", "fresh", "bay views"]
            },
            {
                id: 3,
                name: "Two Sisters Bakery",
                description: "Artisan breads and pastries made fresh daily",
                cuisine: "Bakery", 
                address: "233 E Bunnell Ave, Homer, AK",
                rating: 4.6,
                image: null,
                tags: ["bakery", "coffee", "breakfast"]
            },
            {
                id: 4,
                name: "Homer Brewing Company",
                description: "Local craft brewery with pub fare and Alaska-inspired beers",
                cuisine: "American",
                address: "1411 Lakeshore Dr, Homer, AK",
                rating: 4.4,
                image: null,
                tags: ["brewery", "pizza", "local beer"]
            },
            {
                id: 5,
                name: "Cosmic Kitchen",
                description: "Creative fusion cuisine with fresh, local ingredients",
                cuisine: "Fusion",
                address: "510 E Pioneer Ave, Homer, AK",
                rating: 4.7,
                image: null,
                tags: ["fusion", "creative", "local ingredients"]
            }
        ];

        // Load restaurants with fallback
        async function loadRestaurants() {
            try {
                if (supabase) {
                    console.log('Attempting to load restaurants from Supabase...');
                    const { data, error } = await supabase
                        .from('restaurants')
                        .select('*')
                        .eq('approved', true);
                    
                    if (error) {
                        console.warn('Supabase error:', error);
                        throw error;
                    }
                    
                    if (data && data.length > 0) {
                        restaurants = data;
                        console.log('Loaded restaurants from Supabase:', restaurants.length);
                    } else {
                        throw new Error('No restaurants found in database');
                    }
                } else {
                    throw new Error('Supabase not initialized');
                }
            } catch (error) {
                console.warn('Failed to load from Supabase, using demo data:', error);
                restaurants = demoRestaurants;
            }
            
            displayRestaurants();
        }

        // Initialize auth and check current user
        async function initializeAuth() {
            const authContainer = document.getElementById('authContainer');
            if (!authContainer) return;

            try {
                if (supabase) {
                    // Check if user is already logged in
                    const { data: { user }, error } = await supabase.auth.getUser();
                    
                    if (error) {
                        console.warn('Auth error:', error);
                        throw error;
                    }

                    currentUser = user;
                    updateAuthUI();

                    // Listen for auth changes
                    supabase.auth.onAuthStateChange((event, session) => {
                        console.log('Auth state changed:', event, session?.user?.email);
                        currentUser = session?.user || null;
                        updateAuthUI();
                        if (currentUser) {
                            loadUserFavorites();
                        } else {
                            userFavorites.clear();
                        }
                    });
                } else {
                    // Fallback when Supabase isn't available
                    currentUser = null;
                    updateAuthUI();
                }
            } catch (error) {
                console.warn('Auth initialization failed:', error);
                currentUser = null;
                updateAuthUI();
            }
        }

        // Update auth UI based on current user
        function updateAuthUI() {
            const authContainer = document.getElementById('authContainer');
            if (!authContainer) return;

            if (currentUser) {
                authContainer.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <span class="text-sm text-gray-600">Welcome, ${currentUser.email?.split('@')[0] || 'User'}</span>
                        <button onclick="handleSignOut()" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors">
                            Sign Out
                        </button>
                    </div>
                `;
            } else {
                authContainer.innerHTML = `
                    <button onclick="handleSignIn()" class="px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors">
                        Sign In
                    </button>
                `;
            }
        }

        // Handle sign in
        async function handleSignIn() {
            if (!supabase) {
                alert('Authentication not available');
                return;
            }

            const email = prompt('Enter your email address:');
            if (!email) return;

            try {
                const { error } = await supabase.auth.signInWithOtp({
                    email: email,
                    options: {
                        emailRedirectTo: window.location.origin
                    }
                });

                if (error) throw error;
                
                alert('Check your email for the sign-in link!');
            } catch (error) {
                console.error('Sign in error:', error);
                alert('Failed to send sign-in email: ' + error.message);
            }
        }

        // Handle sign out
        async function handleSignOut() {
            if (!supabase) return;

            try {
                const { error } = await supabase.auth.signOut();
                if (error) throw error;
            } catch (error) {
                console.error('Sign out error:', error);
                alert('Failed to sign out: ' + error.message);
            }
        }

        // Load user favorites
        async function loadUserFavorites() {
            if (!currentUser || !supabase) return;

            try {
                const { data, error } = await supabase
                    .from('favorites')
                    .select('restaurant_id')
                    .eq('user_id', currentUser.id);

                if (error) throw error;

                userFavorites = new Set(data.map(f => f.restaurant_id));
                console.log('Loaded user favorites:', userFavorites.size);
                displayRestaurants(); // Refresh display to show favorites
            } catch (error) {
                console.warn('Failed to load favorites:', error);
            }
        }

        // Display restaurants in grid
        function displayRestaurants() {
            const container = document.getElementById('categoryContainer');
            if (!container) return;
            
            container.innerHTML = '';
            
            // Group restaurants by cuisine
            const groupedRestaurants = {};
            restaurants.forEach(restaurant => {
                const cuisine = restaurant.cuisine || 'Other';
                if (!groupedRestaurants[cuisine]) {
                    groupedRestaurants[cuisine] = [];
                }
                groupedRestaurants[cuisine].push(restaurant);
            });
            
            // Create sections for each cuisine
            Object.entries(groupedRestaurants).forEach(([cuisine, restaurantList]) => {
                const section = document.createElement('div');
                section.className = 'mb-12';
                section.innerHTML = `
                    <h3 class="text-3xl font-bold text-gray-800 mb-8 text-center">${cuisine}</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                        ${restaurantList.map(restaurant => createEnhancedRestaurantCard(restaurant)).join('')}
                    </div>
                `;
                container.appendChild(section);
            });
            
            // Show the view toggle section
            const viewToggleSection = document.getElementById('viewToggleSection');
            if (viewToggleSection) {
                viewToggleSection.classList.remove('hidden');
            }
            
            // Re-initialize Lucide icons
            lucide.createIcons();
        }

        // Filter by tag
        function filterByTag(tag) {
            console.log('Filtering by tag:', tag);
            scrollToRestaurants();
        }

        // Simple modal functions
        function openRestaurantModal(restaurantId) {
            const restaurant = restaurants.find(r => r.id === restaurantId);
            if (!restaurant) return;
            
            const modal = document.getElementById('restaurantModal');
            const modalContent = document.getElementById('modalContent');
            
            modalContent.innerHTML = `
                <h2 class="text-3xl font-bold text-gray-800 mb-4">${restaurant.name}</h2>
                <div class="mb-4">
                    <span class="inline-block bg-orange-100 text-orange-800 px-3 py-1 rounded-full text-sm font-medium">
                        ${restaurant.cuisine}
                    </span>
                    ${restaurant.rating ? `
                        <span class="inline-block ml-2">
                            <i data-lucide="star" class="w-4 h-4 text-yellow-500 fill-current inline"></i>
                            <span class="text-sm font-medium text-gray-700">${restaurant.rating}</span>
                        </span>
                    ` : ''}
                </div>
                <p class="text-gray-600 mb-6">${restaurant.description}</p>
                <div class="space-y-3">
                    <div class="flex items-center text-gray-600">
                        <i data-lucide="map-pin" class="w-5 h-5 mr-3"></i>
                        <span>${restaurant.address}</span>
                    </div>
                    ${restaurant.phone ? `
                        <div class="flex items-center text-gray-600">
                            <i data-lucide="phone" class="w-5 h-5 mr-3"></i>
                            <span>${restaurant.phone}</span>
                        </div>
                    ` : ''}
                    ${restaurant.website ? `
                        <div class="flex items-center text-gray-600">
                            <i data-lucide="external-link" class="w-5 h-5 mr-3"></i>
                            <a href="${restaurant.website}" target="_blank" class="text-orange-500 hover:underline">Visit Website</a>
                        </div>
                    ` : ''}
                </div>
                ${restaurant.tags && restaurant.tags.length > 0 ? `
                    <div class="mt-6">
                        <h4 class="font-semibold text-gray-800 mb-2">Tags</h4>
                        <div class="flex flex-wrap gap-2">
                            ${restaurant.tags.map(tag => 
                                `<span class="bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm">${tag}</span>`
                            ).join('')}
                        </div>
                    </div>
                ` : ''}
            `;
            
            modal.classList.remove('hidden');
            lucide.createIcons();
        }

        function closeRestaurantModal() {
            document.getElementById('restaurantModal').classList.add('hidden');
        }

        function closeSubmissionModal() {
            document.getElementById('submissionModal').classList.add('hidden');
        }

        // Auth placeholder functions
        function initializeAuth() {
            const authContainer = document.getElementById('authContainer');
            if (authContainer) {
                authContainer.innerHTML = `
                    <button class="px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors">
                        Sign In
                    </button>
                `;
            }
        }

        // Auto-scroll functionality
        function scrollToRestaurants() {
            document.getElementById('restaurantsSection').scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }

        // Initialize popular cuisine selection
        function initializeCuisineSelection() {
            const cuisineOptions = document.querySelectorAll('.cuisine-option');
            
            cuisineOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // Remove selected class from all options (single selection)
                    cuisineOptions.forEach(opt => opt.classList.remove('selected'));
                    
                    // Add selected class to clicked option
                    this.classList.add('selected');
                    
                    // Store selected cuisine
                    selectedCuisine = this.dataset.cuisine;
                    
                    // Filter restaurants by cuisine (you'll need to implement this in your script.js)
                    // filterRestaurantsByCuisine(selectedCuisine);
                    
                    // Auto-scroll to restaurants section
                    scrollToRestaurants();
                });
            });
        }

        // Auto-scroll for main buttons
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize cuisine selection
            initializeCuisineSelection();
            
            // Add auto-scroll to "Discover Eats" button
            const findBtn = document.getElementById('findBtn');
            if (findBtn) {
                findBtn.addEventListener('click', scrollToRestaurants);
            }
            
            // Add auto-scroll to "browse all restaurants" button
            const viewAllBtn = document.getElementById('viewAllBtn');
            if (viewAllBtn) {
                viewAllBtn.addEventListener('click', scrollToRestaurants);
            }
        });

        // Enhanced restaurant card creation with favorites
        function createEnhancedRestaurantCard(restaurant) {
            const isFavorited = userFavorites.has(restaurant.id);
            
            return `
                <div class="restaurant-card">
                    <div class="relative">
                        ${restaurant.image ? 
                            `<img src="${restaurant.image}" alt="${restaurant.name}" class="w-full h-48 object-cover">` :
                            `<div class="w-full h-48 bg-gradient-to-br from-orange-200 to-rose-200 flex items-center justify-center">
                                <i data-lucide="utensils" class="w-12 h-12 text-gray-400"></i>
                            </div>`
                        }
                        
                        <button class="favorite-btn ${isFavorited ? 'favorited' : ''}" onclick="toggleFavorite(${restaurant.id}, this)">
                            <i data-lucide="heart" class="w-5 h-5 ${isFavorited ? 'fill-current' : ''}"></i>
                        </button>
                    </div>
                    
                    <div class="p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-2">${restaurant.name}</h3>
                        <p class="text-gray-600 mb-3 line-clamp-2">${restaurant.description || 'A great local dining spot.'}</p>
                        
                        <div class="flex items-center justify-between mb-4">
                            <span class="text-sm font-medium text-orange-600 bg-orange-50 px-3 py-1 rounded-full">
                                ${restaurant.cuisine || 'Restaurant'}
                            </span>
                            ${restaurant.rating ? 
                                `<div class="flex items-center">
                                    <i data-lucide="star" class="w-4 h-4 text-yellow-500 fill-current mr-1"></i>
                                    <span class="text-sm font-medium text-gray-700">${restaurant.rating}</span>
                                </div>` : ''
                            }
                        </div>
                        
                        <button onclick="openRestaurantModal(${restaurant.id})" class="w-full bg-gray-100 hover:bg-gray-200 text-gray-800 font-medium py-3 px-4 rounded-lg transition-colors">
                            View Details
                        </button>
                    </div>
                </div>
            `;
        }

        // Toggle favorite functionality
        async function toggleFavorite(restaurantId, buttonElement) {
            if (!currentUser) {
                alert('Please sign in to save favorites');
                return;
            }

            try {
                if (userFavorites.has(restaurantId)) {
                    // Remove favorite
                    if (supabase) {
                        const { error } = await supabase
                            .from('favorites')
                            .delete()
                            .eq('user_id', currentUser.id)
                            .eq('restaurant_id', restaurantId);
                        
                        if (error) throw error;
                    }
                    
                    userFavorites.delete(restaurantId);
                    buttonElement.classList.remove('favorited');
                    buttonElement.querySelector('i').classList.remove('fill-current');
                } else {
                    // Add favorite
                    if (supabase) {
                        const { error } = await supabase
                            .from('favorites')
                            .insert([{ 
                                user_id: currentUser.id, 
                                restaurant_id: restaurantId 
                            }]);
                        
                        if (error) throw error;
                    }
                    
                    userFavorites.add(restaurantId);
                    buttonElement.classList.add('favorited');
                    buttonElement.querySelector('i').classList.add('fill-current');
                }
                
                // Re-initialize Lucide icons
                lucide.createIcons();
            } catch (error) {
                console.error('Error toggling favorite:', error);
                alert('Failed to update favorite');
            }
        }

        // Initialize everything when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing...');
            
            // Initialize cuisine selection
            initializeCuisineSelection();
            
            // Initialize auth
            initializeAuth();
            
            // Load restaurants
            loadRestaurants();
            
            // Add auto-scroll to main buttons
            const findBtn = document.getElementById('findBtn');
            if (findBtn) {
                findBtn.addEventListener('click', function() {
                    const searchTerm = document.getElementById('tagSearchInput').value;
                    if (searchTerm) {
                        console.log('Searching for:', searchTerm);
                    }
                    scrollToRestaurants();
                });
            }
            
            const viewAllBtn = document.getElementById('viewAllBtn');
            if (viewAllBtn) {
                viewAllBtn.addEventListener('click', scrollToRestaurants);
            }

            // Submit restaurant button
            const submitBtn = document.getElementById('submitRestaurantBtn_bottom');
            if (submitBtn) {
                submitBtn.addEventListener('click', function() {
                    document.getElementById('submissionModal').classList.remove('hidden');
                });
            }

            // Form submission
            const submissionForm = document.getElementById('submissionForm');
            if (submissionForm) {
                submissionForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    alert('Thank you for your submission! We will review it soon.');
                    closeSubmissionModal();
                });
            }
        });

        // Placeholder restaurant modal function (you'll need to implement in your script.js)
        function openRestaurantModal(restaurantId) {
            // Your existing modal logic
            console.log('Opening modal for restaurant:', restaurantId);
        }
    </script>
</body>
</html>
