<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Homer Bites - A Culinary Journey in Homer, Alaska</title>
    <meta name="description" content="Discover the best local eateries, hidden gems, and delightful dining experiences in Homer, Alaska with Homer Bites.">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Montserrat:wght@400;500;600;700&display=swap');

        :root {
            --color-primary: #FF7043;
            --color-secondary: #4CAF50;
            --color-accent: #2196F3;
            --color-text-dark: #333333;
            --color-text-light: #555555;
            --color-bg-light: #F9FAFB;
            --color-bg-paper: #FFFFFF;
            --shadow-subtle: 0 4px 12px rgba(0, 0, 0, 0.05);
            --shadow-medium: 0 8px 24px rgba(0, 0, 0, 0.08);
            --shadow-strong: 0 12px 36px rgba(0, 0, 0, 0.12);
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--color-bg-light);
            color: var(--color-text-light);
            line-height: 1.6;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Playfair Display', serif;
            color: var(--color-text-dark);
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: var(--color-bg-light);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #d1d5db;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #9ca3af;
        }

        .hero-wave {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            overflow: hidden;
            line-height: 0;
            transform: rotate(180deg);
        }

        .hero-wave svg {
            position: relative;
            display: block;
            width: calc(100% + 1.3px);
            height: 150px;
        }

        .hero-wave .shape-fill {
            fill: var(--color-bg-light);
        }

        .btn-hover-scale {
            transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
        }
        .btn-hover-scale:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .restaurant-card {
            position: relative;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .restaurant-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
        }

        .restaurant-card .favorite-btn {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 44px;
            height: 44px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            z-index: 10;
        }

        .restaurant-card .favorite-btn:hover {
            background: rgba(255, 255, 255, 1);
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .restaurant-card .favorite-btn.favorited {
            background: rgba(239, 68, 68, 0.9);
            color: white;
        }

        .restaurant-card .favorite-btn.favorited:hover {
            background: rgba(239, 68, 68, 1);
        }

        input:focus, textarea:focus {
            border-color: var(--color-accent) !important;
            box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.2) !important;
        }
        
        .tag-option.selected {
            background-color: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
        }

        .modal-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }
        .modal-slide-up {
            animation: slideUp 0.3s ease-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        html {
            scroll-behavior: smooth;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-rose-50 min-h-screen font-sans antialiased">

    <header class="sticky top-0 z-50 bg-white/80 backdrop-blur-md shadow-sm border-b border-gray-100 py-3">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between">
            <a href="#" class="flex items-center space-x-3 group animate-fade-in">
                <div class="w-10 h-10 bg-gradient-to-br from-rose-500 to-orange-500 rounded-lg flex items-center justify-center text-white font-extrabold text-xl shadow-md group-hover:shadow-lg transition-all duration-300">
                    HB
                </div>
                <div>
                    <h1 class="text-xl font-bold text-gray-800 tracking-tight">Homer Bites</h1>
                    <p class="text-xs text-gray-500">Discover local food</p>
                </div>
            </a>

            <nav class="hidden md:flex items-center space-x-6 text-sm font-medium">
                <a href="#hero" class="text-gray-600 hover:text-orange-500 transition-colors py-2">Discover</a>
                <a href="#about" class="text-gray-600 hover:text-orange-500 transition-colors py-2">About</a>
                <a href="#contact" class="text-gray-600 hover:text-orange-500 transition-colors py-2">Contact</a>
            </nav>

            <div id="authContainer" class="flex items-center space-x-3">
                <button onclick="handleSignIn()" class="px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors">
                    Sign In
                </button>
            </div>

            <button class="md:hidden p-2 rounded-md hover:bg-gray-100 text-gray-700 transition-colors">
                <i data-lucide="menu" class="w-6 h-6"></i>
            </button>
        </div>
    </header>

    <section id="hero" class="relative bg-gradient-to-br from-blue-100 to-rose-100 py-24 sm:py-32 overflow-hidden text-center">
        <div class="relative z-10 max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-5xl md:text-6xl font-extrabold text-gray-800 leading-tight mb-6 animate-slide-up">
                Savor the Flavor of <span class="text-rose-600">Homer</span>, Alaska
            </h2>
            <p class="text-xl text-gray-600 mb-10 animate-fade-in">Your ultimate guide to Homer's vibrant culinary scene. Find local favorites, hidden gems, and unforgettable meals.</p>

            <div class="relative flex flex-col sm:flex-row items-center justify-center gap-4 mb-8 animate-fade-in">
                <input type="text" id="tagSearchInput" placeholder="Craving something specific? E.g., 'seafood', 'pizza'..." class="w-full sm:w-2/3 lg:w-1/2 px-6 py-4 rounded-full border border-gray-300 shadow-lg focus:ring-2 focus:ring-orange-200 focus:border-orange-500 transition-all outline-none text-gray-700 text-lg">
                <button id="findBtn" class="flex items-center justify-center w-full sm:w-auto px-8 py-4 bg-orange-500 text-white rounded-full shadow-lg hover:bg-orange-600 transition-all duration-300 btn-hover-scale text-lg font-semibold">
                    <i data-lucide="search" class="w-6 h-6 mr-3"></i>
                    Discover Eats
                </button>
            </div>
            
            <div class="flex flex-col items-center justify-center gap-4">
                <button id="viewAllBtn" class="px-6 py-3 text-gray-600 hover:text-orange-500 transition-colors text-lg font-medium">
                    Or simply <span class="underline underline-offset-4 decoration-dashed decoration-gray-400">browse all restaurants</span>
                </button>
                <button id="browseByTagBtn" class="px-6 py-3 text-gray-600 hover:text-orange-500 transition-colors text-lg font-medium">
                    <span class="underline underline-offset-4 decoration-dashed decoration-gray-400">Browse by #tag</span>
                </button>
            </div>
        </div>
        
        <div class="hero-wave">
            <svg data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120" preserveAspectRatio="none">
                <path d="M985.66,92.83C906.67,72,823.79,31,743.84,14.19c-82.26-17.34-168.35-16.64-250.46.15-82.7,17.7-172.14,87.31-257.83,11.3C155.18,74.58,66.44,53.13,0,34.52V0H1200V43.19C1128.15,68.8,1069.1,102.44,985.66,92.83Z" class="shape-fill"></path>
            </svg>
        </div>
    </section>

    <main id="restaurantsSection" class="relative z-10 py-16 bg-gray-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div id="categoryContainer" class="space-y-16">
                <div class="text-center py-16">
                    <div class="mb-6">
                        <i data-lucide="search" class="w-16 h-16 text-gray-300 mx-auto mb-4"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-600 mb-4">Ready to Explore?</h3>
                    <p class="text-gray-500 max-w-md mx-auto">
                        Choose a cuisine above, search for something specific, or browse all restaurants to discover Homer's culinary scene.
                    </p>
                </div>
            </div>
        </div>
    </main>

    <section id="about" class="py-20 bg-gradient-to-br from-blue-50 to-rose-50">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h3 class="text-4xl font-extrabold text-gray-800 mb-6">Our Mission: Connecting You with Homer's Best</h3>
            <p class="text-lg text-gray-700 leading-relaxed mb-8">Homer Bites was built on two things: a deep love for our local food scene and a sheer frustration with trying to find it. We believe finding your next great meal shouldn't require hunting through social media or piecing together search results. Our mission is to showcase the town's incredible culinary talent, helping both lifelong residents and curious visitors easily discover everything from comforting classics to innovative new tastes.</p>
        </div>
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-12">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="bg-white p-8 rounded-2xl shadow-lg">
                    <i data-lucide="heart" class="w-12 h-12 text-orange-500 mb-4"></i>
                    <h4 class="text-2xl font-bold text-gray-800 mb-2">Love for Local</h4>
                    <p class="text-gray-600">Our guide is dedicated to the independent restaurants, cafes, and food trucks owned and operated right here in our community.</p>
                </div>
                <div class="bg-white p-8 rounded-2xl shadow-lg">
                    <i data-lucide="compass" class="w-12 h-12 text-blue-500 mb-4"></i>
                    <h4 class="text-2xl font-bold text-gray-800 mb-2">Effortless Discovery</h4>
                    <p class="text-gray-600">Our platform makes it easy to find exactly what you're craving, with intuitive search and curated categories.</p>
                </div>
                <div class="bg-white p-8 rounded-2xl shadow-lg">
                    <i data-lucide="lightbulb" class="w-12 h-12 text-green-500 mb-4"></i>
                    <h4 class="text-2xl font-bold text-gray-800 mb-2">Community Driven</h4>
                    <p class="text-gray-600">Submit your favorite spots and help us grow our comprehensive guide. Together, we celebrate Homer's culinary spirit.</p>
                </div>
            </div>
        </div>
    </section>

    <section class="py-16 bg-white text-center">
        <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
            <h3 class="text-3xl font-bold text-gray-800 mb-4">Don't See Your Favorite Spot?</h3>
            <p class="text-lg text-gray-600 mb-8">
                Help us make Homer Bites even better! If there's a restaurant you love that's not listed, please let us know.
            </p>
            <button id="submitRestaurantBtn_bottom" class="flex items-center justify-center mx-auto px-8 py-4 bg-rose-500 text-white rounded-full shadow-lg hover:bg-rose-600 transition-all duration-300 btn-hover-scale text-lg font-semibold">
                <i data-lucide="plus" class="w-6 h-6 mr-3"></i>
                Submit a Restaurant
            </button>
        </div>
    </section>

    <div id="restaurantModal" class="fixed inset-0 z-50 hidden modal-fade-in">
        <div class="fixed inset-0 bg-black/40 backdrop-blur-sm" onclick="closeRestaurantModal()"></div>
        <div class="fixed inset-0 flex items-center justify-center p-4">
            <div class="bg-white rounded-3xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl modal-slide-up">
                <div class="relative">
                    <button onclick="closeRestaurantModal()" class="absolute top-4 right-4 z-10 w-10 h-10 bg-gray-100 text-gray-600 rounded-full flex items-center justify-center hover:bg-gray-200 transition-colors shadow-sm">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                    <div id="modalContent" class="p-8">
                        </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="tagModal" class="fixed inset-0 z-50 hidden modal-fade-in">
        <div class="fixed inset-0 bg-black/40 backdrop-blur-sm" onclick="closeTagModal()"></div>
        <div class="fixed inset-0 flex items-center justify-center p-4">
            <div class="bg-white rounded-3xl max-w-lg w-full max-h-[90vh] overflow-y-auto shadow-2xl modal-slide-up">
                <div class="relative p-8">
                    <button onclick="closeTagModal()" class="absolute top-4 right-4 z-10 w-10 h-10 bg-gray-100 text-gray-600 rounded-full flex items-center justify-center hover:bg-gray-200 transition-colors shadow-sm">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Browse by Tag</h2>
                    <div id="tagList" class="flex flex-wrap gap-3 mb-8">
                        </div>
                    <div class="mt-6">
                        <button id="tagDoneBtn" class="w-full flex items-center justify-center px-6 py-3 bg-orange-500 text-white rounded-full shadow-lg hover:bg-orange-600 transition-all duration-300 btn-hover-scale text-base font-semibold">
                            Done
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div id="submissionModal" class="fixed inset-0 z-50 hidden modal-fade-in">
        <div class="fixed inset-0 bg-black/40 backdrop-blur-sm" onclick="closeSubmissionModal()"></div>
        <div class="fixed inset-0 flex items-center justify-center p-4">
            <div class="bg-white rounded-3xl max-w-lg w-full max-h-[90vh] overflow-y-auto shadow-2xl modal-slide-up">
                <div class="relative p-8">
                    <button onclick="closeSubmissionModal()" class="absolute top-4 right-4 z-10 w-10 h-10 bg-gray-100 text-gray-600 rounded-full flex items-center justify-center hover:bg-gray-200 transition-colors shadow-sm">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">Share a Culinary Gem</h2>
                    <p class="text-gray-600 mb-6">Help us grow our directory by suggesting a new restaurant.</p>
                    <form id="submissionForm" class="space-y-5">
                        <div>
                            <label for="restaurantName" class="block text-sm font-medium text-gray-700 mb-1">Restaurant Name</label>
                            <input type="text" id="restaurantName" name="restaurantName" required class="block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-200 focus:border-blue-500 outline-none transition-colors">
                        </div>
                        <div>
                            <label for="restaurantDescription" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                            <textarea id="restaurantDescription" name="restaurantDescription" rows="3" class="block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-200 focus:border-blue-500 outline-none transition-colors" placeholder="Briefly describe the restaurant..."></textarea>
                        </div>
                        <div>
                            <label for="restaurantWebsite" class="block text-sm font-medium text-gray-700 mb-1">Website (Optional)</label>
                            <input type="url" id="restaurantWebsite" name="restaurantWebsite" class="block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-200 focus:border-blue-500 outline-none transition-colors">
                        </div>
                        <div>
                            <label for="restaurantAddress" class="block text-sm font-medium text-gray-700 mb-1">Address</label>
                            <input type="text" id="restaurantAddress" name="restaurantAddress" class="block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-200 focus:border-blue-500 outline-none transition-colors">
                        </div>
                        <div class="mt-6">
                            <button type="submit" class="w-full flex items-center justify-center px-6 py-3 bg-blue-500 text-white rounded-full shadow-lg hover:bg-blue-600 transition-all duration-300 btn-hover-scale text-base font-semibold">
                                <i data-lucide="send" class="w-5 h-5 mr-3"></i>
                                Submit Suggestion
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <footer id="contact" class="bg-gray-800 text-white py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <div class="flex flex-col md:flex-row items-center justify-between space-y-4 md:space-y-0 mb-8">
                <a href="#" class="flex items-center space-x-3 group">
                    <div class="w-10 h-10 bg-gradient-to-br from-rose-500 to-orange-500 rounded-lg flex items-center justify-center text-white font-extrabold text-xl">
                        HB
                    </div>
                    <span class="text-2xl font-bold text-white tracking-tight">Homer Bites</span>
                </a>
                <nav class="flex space-x-6 text-sm font-medium">
                    <a href="#hero" class="text-gray-300 hover:text-white transition-colors">Discover</a>
                    <a href="#about" class="text-gray-300 hover:text-white transition-colors">About Us</a>
                    <a href="#contact" class="text-gray-300 hover:text-white transition-colors">Support</a>
                </nav>
            </div>
            <p class="text-gray-400 text-sm">© 2025 Homer Bites. Crafted with passion for the rich flavors of Homer, Alaska.</p>
        </div>
    </footer>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="modals.js?v=1.4"></script>
    
    <script>
        // Initialize Lucide Icons
        lucide.createIcons();
        
        // Initialize Supabase
        let supabase = null;
        try {
            const SUPABASE_URL = 'https://qtjwacufuwkehfkkijsl.supabase.co';
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF0andhY3VmdXdrZWhma2tpanNsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYwOTY5NTksImV4cCI6MjA3MTY3Mjk1OX0.bh33UFK75tnb13Cr0FhI-MByl0OTEtPj5lJdoJoLuQc';
            
            if (window.supabase && window.supabase.createClient) {
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                console.log('Supabase initialized successfully');
            }
        } catch (error) {
            console.error('Failed to initialize Supabase:', error);
        }

        // Global variables
        let selectedCuisine = null;
        let userFavorites = new Set();
        let restaurants = [];
        let filteredRestaurants = [];
        let currentUser = null;
        let currentPage = 0;
        const restaurantsPerPage = 6;

        // Demo restaurant data
        const demoRestaurants = [
            { id: 1, name: "The Salty Dawg Saloon", description: "Historic saloon with live music and hearty Alaskan fare", cuisine: "American", address: "4380 Homer Spit Rd, Homer, AK", rating: 4.5, tags: ["bar", "live music", "historic"] },
            { id: 2, name: "Coal Point Seafood Company", description: "Fresh local seafood with stunning views of Kachemak Bay", cuisine: "Seafood", address: "4306 Homer Spit Rd, Homer, AK", rating: 4.8, tags: ["seafood", "fresh", "bay views"] },
            { id: 3, name: "Two Sisters Bakery", description: "Artisan breads and pastries made fresh daily", cuisine: "Bakery", address: "233 E Bunnell Ave, Homer, AK", rating: 4.6, tags: ["bakery", "coffee", "breakfast"] },
            { id: 4, name: "Homer Brewing Company", description: "Local craft brewery with pub fare and Alaska-inspired beers", cuisine: "American", address: "1411 Lakeshore Dr, Homer, AK", rating: 4.4, tags: ["brewery", "pizza", "local beer"] },
            { id: 5, name: "Cosmic Kitchen", description: "Creative fusion cuisine with fresh, local ingredients", cuisine: "Asian", address: "510 E Pioneer Ave, Homer, AK", rating: 4.7, tags: ["fusion", "creative", "local ingredients", "seafood"] },
            { id: 6, name: "Fat Olives Restaurant", description: "Italian-inspired dishes with Mediterranean flair", cuisine: "Italian", address: "276 Ohlson Ln, Homer, AK", rating: 4.6, tags: ["italian", "mediterranean", "pasta"] },
            { id: 7, name: "Fresh Sourdough Express Bakery & Café", description: "Breakfast and lunch spot famous for sourdough pancakes", cuisine: "Breakfast", address: "1316 Ocean Dr, Homer, AK", rating: 4.3, tags: ["breakfast", "pancakes", "sourdough", "bakery"] },
            { id: 8, name: "La Cantina", description: "Authentic Mexican cuisine with fresh ingredients", cuisine: "Mexican", address: "120 W Bunnell Ave, Homer, AK", rating: 4.5, tags: ["mexican", "authentic", "fresh"] }
        ];

        // Authentication functions
        async function handleSignIn() {
            if (!supabase) {
                showCustomAlert('Authentication not available - Supabase connection failed', 'error');
                return;
            }

            const credentials = await showCustomPrompt('Sign In', 'your@email.com');
            if (!credentials) return;

            const { email, password } = credentials;

            try {
                const { error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password,
                });

                if (error) {
                    showCustomAlert('Failed to sign in: ' + error.message, 'error');
                } else {
                    showCustomAlert('Signed in successfully!', 'success');
                }
            } catch (error) {
                showCustomAlert('Failed to sign in: ' + error.message, 'error');
            }
        }

        function handleSignOut() {
            if (!supabase) return;
            supabase.auth.signOut().then(({ error }) => {
                if (error) showCustomAlert('Failed to sign out: ' + error.message, 'error');
            });
        }

        function updateAuthUI() {
            const authContainer = document.getElementById('authContainer');
            if (currentUser) {
                const userFirstName = currentUser.user_metadata?.full_name?.split(' ')[0] || currentUser.email.split('@')[0];
                authContainer.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <span class="text-sm text-gray-600">Welcome, ${userFirstName}</span>
                        <a href="profile.html" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors">View Profile</a>
                        <a href="profile.html#favoritesContainer" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors">View Favorites</a>
                        <button onclick="handleSignOut()" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors">Sign Out</button>
                    </div>`;
            } else {
                authContainer.innerHTML = '<button onclick="handleSignIn()" class="px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors">Sign In</button>';
            }
        }
        
        // Load restaurants
        async function loadRestaurants() {
            try {
                if (supabase) {
                    const { data, error } = await supabase.from('restaurants').select('*').eq('status', 'approved');
                    if (!error && data && data.length > 0) {
                        restaurants = data;
                        console.log('Loaded restaurants from Supabase:', restaurants.length);
                        return;
                    }
                }
            } catch (error) {
                console.warn('Supabase error:', error);
            }
            
            restaurants = demoRestaurants;
            console.log('Using demo restaurants:', restaurants.length);
        }

        // Filter and display restaurants
        function filterRestaurants(cuisineFilter, searchTerm) {
            let tempFiltered = [];
            if (cuisineFilter) {
                tempFiltered = restaurants.filter(r => 
                    r.cuisine && r.cuisine.toLowerCase() === cuisineFilter.toLowerCase()
                );
            } else if (searchTerm) {
                const term = searchTerm.toLowerCase();
                tempFiltered = restaurants.filter(r =>
                    r.name.toLowerCase().includes(term) ||
                    r.description.toLowerCase().includes(term) ||
                    (r.cuisine && r.cuisine.toLowerCase().includes(term)) ||
                    (r.tags && r.tags.some(tag => tag.toLowerCase().includes(term)))
                );
            } else {
                tempFiltered = [...restaurants];
            }
            
            filteredRestaurants = tempFiltered;
            currentPage = 0;
            displayRestaurants();
        }
        
        function filterRestaurantsByTags(tags) {
            filteredRestaurants = restaurants.filter(r =>
                tags.every(tag => r.tags && r.tags.map(t => t.toLowerCase()).includes(tag.toLowerCase()))
            );
            currentPage = 0;
            selectedCuisine = tags.map(t => `#${t}`).join(', '); // Update header title
            displayRestaurants();
            scrollToRestaurants();
        }

        function displayRestaurants() {
            const container = document.getElementById('categoryContainer');
            
            if (filteredRestaurants.length === 0) {
                container.innerHTML = '<div class="text-center py-16"><h3 class="text-2xl font-bold text-gray-600 mb-4">No Results Found</h3><p class="text-gray-500">Try a different cuisine or search term.</p></div>';
                return;
            }
            
            const totalPages = Math.ceil(filteredRestaurants.length / restaurantsPerPage);
            const startIndex = currentPage * restaurantsPerPage;
            const currentRestaurants = filteredRestaurants.slice(startIndex, startIndex + restaurantsPerPage);
            
            let html = '<div class="mb-8"><div class="flex items-center justify-between mb-6">';
            html += '<h3 class="text-3xl font-bold text-gray-800">';
            html += selectedCuisine ? selectedCuisine.charAt(0).toUpperCase() + selectedCuisine.slice(1) : 'All Restaurants';
            html += ' <span class="text-lg font-normal text-gray-500 ml-2">(' + filteredRestaurants.length + ' found)</span></h3>';
            
            if (totalPages > 1) {
                html += '<div class="flex items-center space-x-4">';
                html += '<span class="text-sm text-gray-600">Page ' + (currentPage + 1) + ' of ' + totalPages + '</span>';
                html += '<div class="flex items-center space-x-2">';
                html += '<button onclick="previousPage()" ' + (currentPage === 0 ? 'disabled' : '') + ' class="p-2 rounded-lg bg-white border border-gray-200 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"><i data-lucide="chevron-left" class="w-5 h-5 text-gray-600"></i></button>';
                html += '<button onclick="nextPage()" ' + (currentPage >= totalPages - 1 ? 'disabled' : '') + ' class="p-2 rounded-lg bg-white border border-gray-200 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"><i data-lucide="chevron-right" class="w-5 h-5 text-gray-600"></i></button>';
                html += '</div></div>';
            }
            
            html += '</div><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">';
            
            currentRestaurants.forEach(restaurant => {
                const isFavorited = userFavorites.has(restaurant.id);
                html += '<div class="restaurant-card">';
                html += '<div class="relative">';
                html += '<div class="w-full h-48 bg-gradient-to-br from-orange-200 to-rose-200 flex items-center justify-center"><i data-lucide="utensils" class="w-12 h-12 text-gray-400"></i></div>';
                html += '<button class="favorite-btn ' + (isFavorited ? 'favorited' : '') + '" onclick="toggleFavorite(' + restaurant.id + ', this)">';
                html += '<i data-lucide="heart" class="w-5 h-5 ' + (isFavorited ? 'fill-current' : '') + '"></i></button>';
                html += '</div><div class="p-6">';
                html += '<h3 class="text-xl font-bold text-gray-800 mb-2">' + restaurant.name + '</h3>';
                html += '<p class="text-gray-600 mb-3">' + restaurant.description + '</p>';
                html += '<div class="flex items-center justify-between mb-4">';
                html += '<span class="text-sm font-medium text-orange-600 bg-orange-50 px-3 py-1 rounded-full">' + restaurant.cuisine + '</span>';
                if (restaurant.rating) {
                    html += '<div class="flex items-center"><i data-lucide="star" class="w-4 h-4 text-yellow-500 fill-current mr-1"></i><span class="text-sm font-medium text-gray-700">' + restaurant.rating + '</span></div>';
                }
                html += '</div>';
                html += '<button onclick="openRestaurantModal(' + restaurant.id + ')" class="w-full bg-gray-100 hover:bg-gray-200 text-gray-800 font-medium py-3 px-4 rounded-lg transition-colors">View Details</button>';
                html += '</div></div>';
            });
            
            html += '</div></div>';
            container.innerHTML = html;
            lucide.createIcons();
        }

        // Pagination functions
        function nextPage() {
            const totalPages = Math.ceil(filteredRestaurants.length / restaurantsPerPage);
            if (currentPage < totalPages - 1) {
                currentPage++;
                displayRestaurants();
            }
        }

        function previousPage() {
            if (currentPage > 0) {
                currentPage--;
                displayRestaurants();
            }
        }

        // Favorite functionality
        function toggleFavorite(restaurantId, buttonElement) {
            if (!currentUser) {
                showCustomAlert('Please sign in to save favorites', 'info');
                return;
            }

            if (userFavorites.has(restaurantId)) {
                userFavorites.delete(restaurantId);
                buttonElement.classList.remove('favorited');
                buttonElement.querySelector('i').classList.remove('fill-current');
            } else {
                userFavorites.add(restaurantId);
                buttonElement.classList.add('favorited');
                buttonElement.querySelector('i').classList.add('fill-current');
            }
        }

        // Restaurant modal
        function openRestaurantModal(restaurantId) {
            const restaurant = restaurants.find(r => r.id === restaurantId) || filteredRestaurants.find(r => r.id === restaurantId);
            if (!restaurant) return;
            
            const modal = document.getElementById('restaurantModal');
            const modalContent = document.getElementById('modalContent');
            
            let html = '<h2 class="text-3xl font-bold text-gray-800 mb-4">' + restaurant.name + '</h2>';
            html += '<div class="mb-4"><span class="inline-block bg-orange-100 text-orange-800 px-3 py-1 rounded-full text-sm font-medium">' + restaurant.cuisine + '</span>';
            if (restaurant.rating) {
                html += '<span class="inline-block ml-2"><i data-lucide="star" class="w-4 h-4 text-yellow-500 fill-current inline mr-1"></i>' + restaurant.rating + '</span>';
            }
            html += '</div>';
            html += '<p class="text-gray-600 mb-6">' + restaurant.description + '</p>';
            html += '<div class="space-y-3">';
            html += '<div class="flex items-center text-gray-600"><i data-lucide="map-pin" class="w-5 h-5 mr-3"></i><span>' + restaurant.address + '</span></div>';
            html += '</div>';
            
            modalContent.innerHTML = html;
            modal.classList.remove('hidden');
            lucide.createIcons();
        }

        // Modal functions
        function closeRestaurantModal() {
            document.getElementById('restaurantModal').classList.add('hidden');
        }

        function openTagModal() {
            populateTagModal();
            document.getElementById('tagModal').classList.remove('hidden');
        }

        function closeTagModal() {
            document.getElementById('tagModal').classList.add('hidden');
        }

        function populateTagModal() {
            const tagList = document.getElementById('tagList');
            const allTags = [...new Set(restaurants.flatMap(r => r.tags || []))].filter(Boolean);
            allTags.sort();
            tagList.innerHTML = allTags.map(tag => `
                <button class="tag-option px-4 py-2 border border-gray-300 rounded-full hover:bg-gray-100 transition-colors capitalize" data-tag="${tag}">
                    ${tag.replace(/_/g, ' ')}
                </button>
            `).join('');

            tagList.querySelectorAll('.tag-option').forEach(button => {
                button.addEventListener('click', () => {
                    button.classList.toggle('selected');
                });
            });
        }

        function closeSubmissionModal() {
            document.getElementById('submissionModal').classList.add('hidden');
        }

        // Scroll to restaurants
        function scrollToRestaurants() {
            document.getElementById('restaurantsSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Initialize everything
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('Initializing Homer Bites...');
            
            await loadRestaurants();
            
            if (supabase) {
                const { data: { user } } = await supabase.auth.getUser();
                currentUser = user;
                updateAuthUI();
                
                supabase.auth.onAuthStateChange((event, session) => {
                    currentUser = session?.user || null;
                    updateAuthUI();
                });
            }
            
            document.querySelectorAll('.cuisine-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.cuisine-option').forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedCuisine = this.dataset.cuisine;
                    filterRestaurants(selectedCuisine, null);
                    scrollToRestaurants();
                });
            });
            
            document.getElementById('findBtn').addEventListener('click', function() {
                const searchTerm = document.getElementById('tagSearchInput').value.trim();
                if (searchTerm) {
                    selectedCuisine = null;
                    filterRestaurants(null, searchTerm);
                    scrollToRestaurants();
                } else {
                    showCustomAlert('Please enter a search term to discover restaurants', 'info');
                }
            });
            
            document.getElementById('viewAllBtn').addEventListener('click', function() {
                selectedCuisine = null;
                filterRestaurants();
                scrollToRestaurants();
            });

            document.getElementById('browseByTagBtn').addEventListener('click', openTagModal);
            
            document.getElementById('tagDoneBtn').addEventListener('click', function() {
                const selectedTags = [...document.querySelectorAll('#tagList .tag-option.selected')].map(btn => btn.dataset.tag);
                if (selectedTags.length > 0) {
                    filterRestaurantsByTags(selectedTags);
                }
                closeTagModal();
            });

            document.getElementById('submitRestaurantBtn_bottom').addEventListener('click', function() {
                document.getElementById('submissionModal').classList.remove('hidden');
            });
            
            document.getElementById('submissionForm').addEventListener('submit', function(e) {
                e.preventDefault();
                showCustomAlert('Thank you for your submission! We will review it soon.', 'success');
                closeSubmissionModal();
            });
        });
    </script>
</body>
</html>
